{
  "name": "dcos-grid",
  "description": "Installs/Configures DC/OS Cluster Node.",
  "long_description": "dcos-grid Cookbook\n==================\n\nThis cookbook sets up your customized DC/OS cluster on bare metal, virtual machines and every cloud. This install method is based on [_Advanced DC/OS Installation Guide_](https://dcos.io/docs/1.8/administration/installing/custom/advanced/).\n\n## Contents\n\n- [Requirements](#requirements)\n  - [platforms](#platforms)\n  - [packages](#packages)\n  - [cookbooks](#cookbooks)\n- [Attributes](#attributes)\n- [Usage](#usage)\n  - [Recipes](#recipes)\n    - [dcos-grid::default](#dcos-griddefault)\n    - [dcos-grid::agent](#dcos-gridagent)\n    - [dcos-grid::bootstrap](#dcos-gridbootstrap)\n    - [dcos-grid::cli (ver. 0.3.0 or later)](#dcos-gridcli-ver-030-or-later)\n    - [dcos-grid::cloud-config (for CoreOS only)](#dcos-gridcloud-config-for-coreos-only)\n    - [dcos-grid::master](#dcos-gridmaster)\n    - [dcos-grid::node](#dcos-gridnode)\n    - [dcos-grid::node-commons](#dcos-gridnode-commons)\n    - [dcos-grid::public-agent](#dcos-gridpublic-agent)\n    - [dcos-grid::universe-build-env (ver. 0.4.8 or later)](#dcos-griduniverse-build-env-ver-048-or-later)\n    - [dcos-grid::universe-server (ver. 0.4.9 or later)](#dcos-griduniverse-server-ver-049-or-later)\n  - [Role Examples](#role-examples)\n  - [Upgrade DC/OS (ver. 0.4.3 or later)](#upgrade-dcos-ver-043-or-later)\n  - [Uninstall DC/OS](#uninstall-dcos)\n- [License and Authors](#license-and-authors)\n\n## Requirements\n\n### platforms\n- CentOS, Red Hat Enterprise Linux >= 7.2\n- CoreOS Latest version.\n- Ubuntu 16.04 (Experimental). DC/OS does not officially support Ubuntu yet. See [_Ubuntu 16.04 Enablement_](https://dcosjira.atlassian.net/browse/DCOS-25).\n  - DC/OS requires systemd, which is only fully supported in Ubuntu 15.04 and later releases. See [_SystemdForUpstartUsers_](https://wiki.ubuntu.com/SystemdForUpstartUsers)\n\n### packages\n- none.\n\n### cookbooks\n- `docker-grid` (for `dcos-grid` ver. 0.4.0 or later).\n\n## Attributes\n\n|Key|Type|Description, example|Default|\n|:--|:--|:--|:--|\n|`['dcos-grid']['dcos_release_url']`|String|DC/OS download URL.|`'https://downloads.dcos.io/dcos/stable/dcos_generate_config.sh'`|\n|`['dcos-grid']['dcos_release_checksum']`|String|sha256 checksum of the DC/OS release. (ver. 0.5.0 or later)|`nil` (no check)|\n|`['dcos-grid']['dcos_release_script_name']`|String|OSS edition: `'dcos_generate_config.sh'`, Enterprise edition: `'dcos_generate_config.ee.sh'`  (ver. 0.4.8 or later).|`Pathname(URI(node['dcos-grid']['dcos_release_url']).path).basename`|\n|`['dcos-grid']['dcos_cli_release_url']`|String|DEPRECATED: DC/OS CLI download URL (ver. 0.3.0 or later).|`\"https://downloads.dcos.io/binaries/cli/linux/x86-64/#{node['dcos-grid']['cli']['version']}/dcos\"`|\n|`['dcos-grid']['dcos_cli_upgrade']`|Boolean|DEPRECATED: Whether upgrade DC/OS CLI or not (ver. 0.4.3 or later).|`false`|\n|`['dcos-grid']['cli']['version']`|String|DC/OS CLI version (ver. 0.5.0 or later)|`'0.4.14'`|\n|`['dcos-grid']['cli']['release_url']`|String| (ver. 0.5.0 or later)|`node['dcos-grid']['dcos_cli_release_url']`|\n|`['dcos-grid']['cli']['release_checksum']`|String|sha256 checksum of the DC/OS CLI release. (ver. 0.5.0 or later)|`nil` (no check)|\n|`['dcos-grid']['cli']['auto_upgrade']`|Boolean| (ver. 0.5.0 or later)|`node['dcos-grid']['dcos_cli_upgrade']`|\n|`['dcos-grid']['cli']['install_path']`|String| (ver. 0.5.0 or later)|`'/usr/local/bin/dcos'`|\n|`['dcos-grid']['docker']['apt_repo']['url']`|String|DEPRECATED: use `['docker-grid']['apt_repo']['url']` (ver. 0.4.0 or later)|`nil`|\n|`['dcos-grid']['docker']['apt_repo']['keyserver']`|String|DEPRECATED: use `['docker-grid']['apt_repo']['keyserver']` (ver. 0.4.0 or later)|`nil`|\n|`['dcos-grid']['docker']['apt_repo']['recv-keys']`|String|DEPRECATED: use `['docker-grid']['apt_repo']['recv-keys']` (ver. 0.4.0 or later)|`nil`|\n|`['dcos-grid']['docker']['yum_repo']['baseurl']`|String|DEPRECATED: use `['docker-grid']['yum_repo']['baseurl']` (ver. 0.4.0 or later)|`nil`|\n|`['dcos-grid']['docker']['yum_repo']['gpgcheck']`|String|DEPRECATED: use `['docker-grid']['yum_repo']['gpgcheck']` (ver. 0.4.0 or later). `'0'`: disabled, `'1'`: enabled.|`nil`|\n|`['dcos-grid']['docker']['yum_repo']['gpgkey']`|String|DEPRECATED: use `['docker-grid']['yum_repo']['gpgkey']` (ver. 0.4.0 or later)|`nil`|\n|`['dcos-grid']['docker-engine']['setup']`|Boolean|Docker setup by this cookbook. If you will set up Docker by another cookbook, verify that this attribute is false. (ver. 0.3.0 or later)|`true`|\n|`['dcos-grid']['docker-engine']['version_on_centos']`|String|DEPRECATED: use `['docker-grid']['engine']['version_on_centos']` (ver. 0.4.0 or later). Docker version for CentOS.|`nil`|\n|`['dcos-grid']['docker-engine']['version_on_ubuntu']`|String|DEPRECATED: use `['docker-grid']['engine']['version_on_ubuntu']` (ver. 0.4.0 or later). Docker version for Ubuntu.|`nil`|\n|`['dcos-grid']['docker-engine']['version']`|String|DEPRECATED: use `['docker-grid']['engine']['version']` (ver. 0.4.0 or later). Docker 1.9.x - 1.11.x is recommended for stability reasons. Note: this **default** value is overwritten by the `version_on_{centos or ubuntu}`.|See default.rb|\n|`['dcos-grid']['docker-engine']['storage-driver_on_centos']`|String|DEPRECATED: use `['docker-grid']['engine']['storage-driver_on_centos']` (ver. 0.4.0 or later). Docker storage driver (overlay, devicemapper, ...) for CentOS.|`nil`|\n|`['dcos-grid']['docker-engine']['storage-driver_on_ubuntu']`|String|DEPRECATED: use `['docker-grid']['engine']['storage-driver_on_ubuntu']` (ver. 0.4.0 or later). Docker storage driver (aufs, overlay, ...) for Ubuntu.|`nil`|\n|`['dcos-grid']['docker-engine']['storage-driver']`|String|DEPRECATED: use `['docker-grid']['engine']['storage-driver']` (ver. 0.4.0 or later).|See default.rb|\n|`['dcos-grid']['docker-engine']['daemon_extra_options']`|String|DEPRECATED: use `['docker-grid']['engine']['daemon_extra_options']` (ver. 0.4.0 or later). ref. `docker daemon --help`.|`nil`|\n|`['dcos-grid']['bootstrap']['ip']`|String|Bootstrap node IP address.|`'127.0.0.1'`|\n|`['dcos-grid']['bootstrap']['port']`|String|Bootstrap node port number.|`'8080'`|\n|`['dcos-grid']['bootstrap']['genconf_dir']`|String|genconf directory path. Note: This is overridden by the value `\"#{node['dcos-grid']['cloud-config']['target_dir']}/genconf\"` in the `cloud-config` recipe (ver. 0.3.5 or later).|`'/opt/dcos-grid/genconf'`|\n|`['dcos-grid']['bootstrap']['config']`|Hash|Install configurations.|see [_Install Configuration Parameters_](https://dcos.io/docs/1.8/administration/installing/custom/configuration-parameters/)|\n|`['dcos-grid']['bootstrap']['config']['bootstrap_url']`|String||`\"http://#{node['dcos-grid']['bootstrap']['ip']}:#{node['dcos-grid']['bootstrap']['port']}\"`|\n|`['dcos-grid']['bootstrap']['config']['cluster_name']`|String||`'dcos0'`|\n|`['dcos-grid']['bootstrap']['config']['exhibitor_storage_backend']`|String||`'static'`|\n|`['dcos-grid']['bootstrap']['config']['ip_detect_filename']`|String||`'/genconf/ip-detect'`|\n|`['dcos-grid']['bootstrap']['config']['master_discovery']`|String|(ver. 0.3.2 or later)|`'static'`|\n|`['dcos-grid']['bootstrap']['config']['master_list']`|Array|e.g. `['192.168.1.101','192.168.1.102','192.168.1.103']`|`nil`|\n|`['dcos-grid']['bootstrap']['config']['oauth_auth_host']`|String|(ver. 0.3.2 or later)|`'https://dcos.auth0.com'`|\n|`['dcos-grid']['bootstrap']['config']['oauth_auth_redirector']`|String|(ver. 0.3.2 or later)|`'https://auth.dcos.io'`|\n|`['dcos-grid']['bootstrap']['config']['oauth_available']`|String|(ver. 0.3.2 or later)|`'true'`|\n|`['dcos-grid']['bootstrap']['config']['oauth_enabled']`|String|(ver. 0.3.2 or later)|`'true'`|\n|`['dcos-grid']['bootstrap']['config']['oauth_issuer_url']`|String|(ver. 0.3.2 or later)|`'https://dcos.auth0.com/'`|\n|`['dcos-grid']['bootstrap']['config']['resolvers']`|Array|e.g. `['8.8.8.8','8.8.4.4']` (Google DNS)|`nil`|\n|`['dcos-grid']['bootstrap']['config']['telemetry_enabled']`|String||`'false'` (ver. 0.4.1 or later)|\n|`['dcos-grid']['bootstrap']['bootstrap']['ip-detect']['interface']`|String|Network interface on each node for the `ip-detect` script. Note: If you set comma-delimited interface list (e.g. `'eth0,enp0s3'`), the first detected interface's ip is adopted (ver. 0.3.0 or later). |`'eth0'`|\n|`['dcos-grid']['node']['auto_setup']`|Boolean|execute the node setup script automatically or not.|`false`|\n|`['dcos-grid']['cloud-config']['target_platform']`|String|CoreOS only now.|`'coreos'`|\n|`['dcos-grid']['cloud-config']['target_dir']`|String||`'/home/core'`|\n|`['dcos-grid']['cloud-config']['target_owner']`|String||`'core:core'`|\n|`['dcos-grid']['cloud-config']['hostname']`|String||`'<fqdn>'`|\n|`['dcos-grid']['cloud-config']['timezone']`|String||`'Etc/GMT'`|\n|`['dcos-grid']['cloud-config']['ssh_authorized_keys']`|Array||`['<your_ssh_pub_key>',]`|\n|`['dcos-grid']['universe-server']['docker-compose']['app_dir']`|String||`'/opt/docker-compose/app/dcos-universe'`|\n|`['dcos-grid']['universe-server']['docker-compose']['config']`|Hash|`docker-compose.yml` configurations.|See `attributes/default.rb`|\n\n## Usage\n\n### Recipes\n\n#### dcos-grid::default\n\nThis recipe does nothing.\n\n#### dcos-grid::agent\n\nThis recipe sets up a private agent node. Note: If `node['dcos-grid']['node']['auto_setup']` is `false`, you must execute the following manually.\n\n```\n$ /opt/dcos-grid/node_setup.sh slave\n```\n\n#### dcos-grid::bootstrap\n\nThis recipe sets up a bootstrap node. Note: Please execute the following manually.\n\n```\n$ /opt/dcos-grid/bootstrap_setup.sh\n```\n\n#### dcos-grid::cli (ver. 0.3.0 or later)\n\nThis recipe installs DC/OS CLI.\n\n#### dcos-grid::cloud-config (for CoreOS only)\n\nThis recipe generates a `/home/core/cloud-config.yaml` template file on local machine by the following `chef-solo` command.\n\n```\n$ sudo chef-solo -c solo.rb -j nodes/local-dcos0-cloud-config.json\n```\n\n- `nodes/local-dcos0-cloud-config.json`\n\n```json\n{\n  \"run_list\": [\n    \"role[dcos0-cloud-config]\"\n  ]\n}\n```\n\n- `roles/dcos0-cloud-config.rb`\n\n```ruby\ncluster_name = 'dcos0'\n\nname \"#{cluster_name}-cloud-config\"\ndescription \"#{cluster_name} cloud-config.yaml file.\"\n\nrun_list(\n  \"role[#{cluster_name}]\",  # includes common attributes.\n  'recipe[dcos-grid::cloud-config]',\n)\n```\n\nThen edit this yaml template (hostname, ssh_authorized_keys, IP address and so on) and install CoreOS by the `cloud-config.yaml`.\n\n```\n$ coreos-cloudinit -from-file ~/cloud-config.yaml -validate\n...\n$ sudo coreos-install -d /dev/sda -C stable -c ~/cloud-config.yaml\n```\n\n#### dcos-grid::gp-node\n\nThis recipe sets up a general-purpose (GP) node (particular role is not assigned yet). Note: Please execute which of the following commands as needed.\n\n```\n$ /opt/dcos-grid/bootstrap_setup.sh\n or\n$ /opt/dcos-grid/node_setup.sh master\n or\n$ /opt/dcos-grid/node_setup.sh agent\n or\n$ /opt/dcos-grid/node_setup.sh agent_public\n```\n\n#### dcos-grid::master\n\nThis recipe sets up a master node. Note: If `node['dcos-grid']['node']['auto_setup']` is `false`, you must execute the following manually.\n\n```\n$ /opt/dcos-grid/node_setup.sh master\n```\n\n#### dcos-grid::node\n\nThis recipe sets up a base node (particular role is not assigned yet). Note: Please execute the following manually.\n\n```\n$ /opt/dcos-grid/node_setup.sh {master|slave|slave_public}\n```\n\n#### dcos-grid::node-commons\n\nThis recipe sets up common environment for DC/OS node.\n\n#### dcos-grid::public-agent\n\nThis recipe sets up a public node. Note: If `node['dcos-grid']['node']['auto_setup']` is `false`, you must execute the following manually.\n\n```\n$ /opt/dcos-grid/node_setup.sh slave_public\n```\n\n#### dcos-grid::universe-build-env (ver. 0.4.8 or later)\n\nThis recipe sets up the build environment for DC/OS Universe (package repository) server.\n\n#### dcos-grid::universe-server (ver. 0.4.9 or later)\n\nThis recipe sets up a DC/OS Universe (package repository) server.\n\n### Role Examples\n\n- `roles/dcos0.rb`: Common attributes.\n\n```ruby\ncluster_name = 'dcos0'\n\nname cluster_name\ndescription \"#{cluster_name} cluster\"\n\nrun_list(\n)\n\noverride_attributes(\n  'docker-grid' => {\n    'engine' => {\n      'version_on_centos' => '1.11.2-1',\n      'version_on_ubuntu' => '1.11.2-0',\n      #'version' => '1.11.2-1.el7.centos',\n    },\n  },\n  'dcos-grid' => {\n    'dcos_release_url' => 'https://downloads.dcos.io/dcos/stable/dcos_generate_config.sh',\n    #'dcos_release_url' => 'https://downloads.dcos.io/dcos/EarlyAccess/dcos_generate_config.sh',\n    # DC/OS 1.8.7\n    'dcos_release_checksum' => 'ddd9a86e4fc6ab149fb6c2ce38fc7d7c2f5891e62fb5ed41b91c3e99e02ed536',\n    'bootstrap' => {\n      'ip' => '192.168.56.100',\n      'port' => '8080',\n      'config' => {\n        'cluster_name' => cluster_name,\n        'master_list' => [\n          '192.168.56.101',\n          '192.168.56.102',\n          '192.168.56.103',\n        ],\n        'resolvers' => [\n          '8.8.8.8',\n          '8.8.4.4',\n        ],\n      },\n      'ip-detect' => {\n        'interface' => 'eth1,enp0s8',\n      },\n    },\n    'node' => {\n      'auto_setup' => false,\n    },\n  },\n)\n```\n\n- `roles/dcos0-boot.rb`\n\n```ruby\ncluster_name = 'dcos0'\n\nname \"#{cluster_name}-boot\"\ndescription \"#{cluster_name} cluster bootstrap node\"\n\nrun_list(\n  \"role[#{cluster_name}]\",\n  'recipe[dcos-grid::bootstrap]',\n)\n```\n\n- `roles/dcos0-master.rb`\n\n```ruby\ncluster_name = 'dcos0'\n\nname \"#{cluster_name}-master\"\ndescription \"#{cluster_name} cluster master node\"\n\nrun_list(\n  \"role[#{cluster_name}]\",\n  'recipe[dcos-grid::master]',\n)\n\noverride_attributes(\n  'dcos-grid' => {\n    'node' => {\n      'auto_setup' => false,\n    },\n  },\n)\n```\n\n- `roles/dcos0-agent.rb`\n\n```ruby\ncluster_name = 'dcos0'\n\nname \"#{cluster_name}-agent\"\ndescription \"#{cluster_name} cluster private agent node\"\n\nrun_list(\n  \"role[#{cluster_name}]\",\n  'recipe[dcos-grid::agent]',\n)\n\noverride_attributes(\n  'dcos-grid' => {\n    'node' => {\n      'auto_setup' => true,\n    },\n  },\n)\n```\n\n- `roles/dcos0-cli.rb`\n\n```ruby\ncluster_name = 'dcos0'\n\nname \"#{cluster_name}-cli\"\ndescription \"#{cluster_name} CLI setup\"\n\nrun_list(\n  \"role[#{cluster_name}]\",\n  'recipe[dcos-grid::cli]',\n)\n\noverride_attributes(\n  'dcos-grid' => {\n    'cli' => {\n      'version' => '0.4.14',\n      'release_checksum' => '070587062c7c0b926e2438a383b05c942e99ccf909421feed4941d06e3846fa7',\n      'auto_upgrade' => true,\n      'install_path' => '/usr/local/bin/dcos',\n    },\n  },\n)\n```\n\n- `roles/dcos0-universe-server.rb`\n\n```ruby\ncluster_name = 'dcos0'\n\nname \"#{cluster_name}-universe-server\"\ndescription \"#{cluster_name} universe server\"\n\nrun_list(\n  \"role[#{cluster_name}]\",\n  'recipe[dcos-grid::universe-server]',\n)\n\noverride_attributes(\n  'dcos-grid' => {\n    'universe-server' => {\n      'docker-compose' => {\n        'config' => {\n          'version' => '2',\n          'services' => {\n            'universe' => {\n              'image' => 'my_account/universe-server:my_tag',\n              'ports' => [\n                '8085:80',\n              ],\n            },\n          },\n        },\n      },\n    },\n  },\n)\n```\n\n### Upgrade DC/OS (ver. 0.4.3 or later)\n\n- Update attributes about DC/OS release URL (`['dcos-grid']['dcos_release_url']`) and configurations (`['dcos-grid']['bootstrap']['config']`).\n\n- execute `sudo chef-client` on each node.\n\n- upgrade the boostrap node.\n\n```\n$ /opt/dcos-grid/bootstrap_upgrade.sh\n```\n\n- upgrade each follower master node at first, and then upgrade the leader master node.\n\n```\n$ /opt/dcos-grid/node_upgrade.sh master\n```\n\n- upgrade each agent node.\n\n```\n$ /opt/dcos-grid/node_upgrade.sh {slave|slave_public}\n```\n\n- commit the upgrade on the bootstrap node.\n\n```\n$ /opt/dcos-grid/bootstrap_upgrade.sh -c\n```\n\n### Uninstall DC/OS\n\nPlease log in each node and execute the following.\n\n```\n$ /opt/dcos-grid/uninstall.sh\n```\n\n## License and Authors\n\n- Author:: whitestar at osdn.jp\n\n```text\nCopyright 2016-2017, whitestar\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n```\n",
  "maintainer": "whitestar",
  "maintainer_email": "",
  "license": "Apache 2.0",
  "platforms": {
    "centos": ">= 7.2",
    "redhat": ">= 7.2",
    "ubuntu": ">= 16.04"
  },
  "dependencies": {
    "docker-grid": ">= 0.3.1"
  },
  "recommendations": {

  },
  "suggestions": {

  },
  "conflicting": {

  },
  "providing": {

  },
  "replacing": {

  },
  "attributes": {

  },
  "groupings": {

  },
  "recipes": {

  },
  "version": "0.5.4",
  "source_url": "http://scm.osdn.jp/gitroot/metasearch/grid-chef-repo.git",
  "issues_url": "https://osdn.jp/projects/metasearch/ticket",
  "privacy": false,
  "chef_versions": [

  ],
  "ohai_versions": [

  ],
  "gems": [

  ]
}
