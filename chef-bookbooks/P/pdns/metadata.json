{"name":"pdns","version":"4.4.0","description":"Installs/Configures PowerDNS Recursor and Authoritative server","long_description":"# PowerDNS Community Cookbook\n\nProvides resources for installing and configuring both PowerDNS authoritative and recursor. It uses the official PowerDNS repositories for packages and installs the appropiate configuration for your platform's init system.\n\n## Build Status\n\n[![Build Status](https://travis-ci.org/dnsimple/chef-pdns.svg?branch=master)](https://travis-ci.org/dnsimple/chef-pdns)\n\n## Requirements\n\nIMPORTANT: Please read the Deprecations and Compatibility Notes sections below since there are breaking changes between versions 2 and 3 of this cookbook.\n\n### Deprecations\n\n  - The recipe and attribute based way of setting different PowerDNS installs is completely deprecated, there are no  attributes in the newest version of this cookbok neither recipes to add to the run list.\n  - `pdnsrecord` and `domainrecord` resources have been deprecated since they were coupled with sqlite3 backend.\n  - Ubuntu 12.02 support has been removed, if you want this platform to be supported PRs are welcome, see the CONTRIBUTING.md file.\n\n### 4.x Compatibility Notes\n\nUsers of the previous versions of the cookbook may find a few breaking changes. Here are the highlights:\n\n#### Chef 12.14 or newer\n\nTo help clear up additional code and remove the 'yum' cookbook dependency, we have jumped up to Chef 12.14 as the minimum version. We'll look into the potential options of removing the 'apt' cookbook dependency as well.\n\n#### pdns_authoritative_backend has been removed\n\nThis resource has been removed entirely because it would be easier to support allowing the user to select packages appropriate for their platform in the future and ease the burden on the maintainers for keeping what amounted to a massive hash table. To see how we achieved this setup, check out the test cookbook postgresql recipe under the `test/` directory.\n\n#### original instance is the new default\n\nThe previous version forced you down the path of creating virtual instances of a resolver or authoritative and left the original in place. This release now _assumes_ you want to modify the original instance or create a virtual one based upon the original instance setup. If you look at the single install recipes, you'll see how this is done as the default case. Any named install or config resources without a name will use the default setup instance that comes with the package.\n\nIn most cases you want to only run one instance of PowerDNS Authoritative or Recursor on your system which is why we have now assumed this default for you.\n\n#### Instance naming scheme\n\nThe instance naming schemes between versions of the 3.x cookbook were admittedly very inconsistent. We now directly follow the [virtual instance naming scheme documentation at PowerDNS](https://doc.powerdns.com/md/authoritative/running/#virtual-hosting) which will cause some breakage for you under the covers. You'll unfortunately have to review what your services are currently named and remove them if they clash with the updated naming scheme. Specifically check for underscores and hyphens in the name.\n\nSpeaking of instance naming, we now reject any virtual service name that contains a hypen. You will see a cookbook compile error if that is the case.\n\n#### socket_dir property for recursor init service has been removed\n\nThis was not implemented correctly in the previous versions and it has been removed since it is now implemented via the custom init script\n\n### Platforms:\n\n- Ubuntu 14.04 and newer\n- Debian 8 and newer\n- RHEL 7 and newer\n- CentOS 6.9 and newer\n\n### Chef:\n\n- Chef 12.14 or newer\n\n### Init Systems:\n\n* SysV\n* systemd\n\n### Required Cookbooks:\n\n- apt\n\n## Usage\n\nCombine the different resources in order to install, configure, and manage your PowerDNS instances. This is a list of resouces that can be used:\n\n  | Resource                            | Functionality                                     |\n  |-------------------------------------|---------------------------------------------------|\n  | pdns_authoritative_install          | Installs an authoritative server                  |\n  | pdns_authoritative_config           | Configures an authoritative instance              |\n  | pdns_authoritative_service          | Manages an authoritative instance                 |\n  | pdns_recursor_install               | Installs a recusor                                |\n  | pdns_recursor_config                | Configures a recursor instance                    |\n  | pdns_recursor_service               | Manages a a recursor instance                     |\n\nTo fully configure an authoritative server you need to add at least 3 resources to your recipe, `pdns_authoritative_install`, `pdns_authoritative_config` and `pdns_authoritative_service`. If you want to install any backend other than the default (bind) for the authoritative server you need to install the corresponding packages for the backend you want. There is an example for a postgresql backend in `test/cookbooks/pdns_test/recipes/`.\n\nFor a recursor use the `pdns_recursor_install`, `pdns_recursor_config`, and `pdns_recursor_service` resources in your wrapper cookbooks to install, configure, and define PowerDNS recursors. Set the different properties on the resources according to your install and configuration needs. You can see a good example of this in `test/cookbooks/pdns_test/recipes_recursor_install_single.rb`\n\nFor advanced use it is recommended to take a look at the chef resources themselves.\n\n### Properties\n\n#### A note about instance names\n\nPowerDNS parses the name of the instance by breaking apart the first hyphen it sees so all virtual service names (ones without a blank string) start with the service type and a hyphen. For example:\n\n```ruby\npdns_authoritative_config 'server_01' do\n  action :create\n  launch ['gpgsql']\n  variables(\n    gpgsql_host: '127.0.0.1',\n    gpgsql_user: 'pdns',\n    gpgsql_port: 5432,\n    gpgsql_dbname: 'pdns',\n    gpgsql_password: 'wadus'\n  )\nend\n\npdns_authoritative_service 'service_01' do\n  action [:enable, :start]\nend\n```\n\nWill create a file named `/etc/powerdns/pdns-server_01.conf`:\n\n```\nlaunch ['gpgsql']\ngpgsql-host=127.0.0.1\ngpgsql-user=pdns\ngpgsql-port=5432\ngpgsql-dbname=pdns\ngpgsql-password=wadus\n```\n\nAnd a service named `pdns-server_01` which is symbolically linked linked to `pdns` if you are using SysVinit.\n\n#### General note about resource properties\n\nMost properties are simple ruby strings, but there is another cases that require special attention.\nProperties specified as elements in arrays will be split up (see split ruby method) and separated by commas.\nBoolean properties will be always translated to 'yes' or 'no'.\nSome properties need to be set consistently accross resources, they will be noted in their specific sections at the top under 'Consistent?'.\nMost of the properties are optional and have sane defaults, so they are only recommended for customized installs.\n\n### pdns_authoritative_install\n\nInstalls PowerDNS authoritative server 4.X series using PowerDNS official repository in the supported platforms.\n\n#### Properties\n\n| Name          | Class       |  Default value | Consistent?|\n|---------------|-------------|----------------|------------|\n| instance_name | String      | name_property  | Yes|\n| version       | String, nil | nil            | No |\n| debug         | true, false | false          | No |\n\n#### Usage example\n\nInstall a PowerDNS authoritative server package named `server-01` with the latest version available in the repository.\n\n```\npdns_authoritative_install 'server_01' do\n  action :install\nend\n```\n\n### pdns_authoritative_config\n\nCreates a PowerDNS recursor configuration, there is a fixed set of required properties (listed below) but most of the configuration is left to the user freely, every property set in the `variables` hash property will be rendered in the config template. Remember that using underscores `_` for property names is required and it's translated to hyphens `-` in configuration templates.\n\n#### Properties\n\n| Name           | Class      |  Default value  | Consistent? |\n|----------------|------------|-----------------|-------------|\n| instance_name  | String     | name_property   | Yes         |\n| launch         | Array, nil | ['bind']        | No          |\n| config_dir     | String     | see `default_authoritative_config_directory` helper method | Yes |\n| socket_dir     | String     | \"/var/run/#{resource.instance_name}\" | Yes |\n| run_group      | String     | see `default_authoritative_run_user` helper method  | No |\n| run_user       | String     | see `default_authoritative_run_user` helper method  | No |\n| run_user_home  | String     | see `default_user_attributes` helper method | No |\n| run_user_shell | String     | see `default_user_attributes` helper method | No |\n| setuid         | String     | resource.run_user | No |\n| setgid         | String     | resource.run_group | No |\n| source         | String,nil | 'authoritative_service.conf.erb' | No |\n| cookbook       | String,nil | 'pdns' | No |\n| variables      | Hash       | { bind_config:  \"#{resource.config_dir}/bindbackend.conf\" } | No |\n\n#### Usage Example\n\nCreate a PowerDNS authoritative configuration file named `server-01`:\n\n```\npdns_authoritative_config 'server_01' do\n  action :create\n  launch ['gpgsql']\n  variables(\n    gpgsql_host: '127.0.0.1',\n    gpgsql_user: 'pdns',\n    gpgsql_port: 5432,\n    gpgsql_dbname: 'pdns',\n    gpgsql_password: 'wadus',\n    allow_axfr_ips: [ '127.0.0.0/8', '::1', '195.234.23,34'],\n    api: true,\n    api-_eadonly: true\n    )\nend\n```\n\n### pdns_authoritative_service\n\nCreates a init service to manage a PowerDNS authoritative instance. This service supports all the regular actions (start, stop, restart, etc.). Check the compatibility section to see which init services are supported.\n\n*Important:* services are not restarted or reloaded automatically on config changes in this cookbook, you need to add this in your wrapper cookbook if you desire this functionality, the `pdns_authoritative_service` cookbook provides actions to do it.\n\n#### Properties\n\n| Name           | Class       |  Default value                                             | Consistent? |\n|----------------|-------------|------------------------------------------------------------|-------------|\n| instance_name  | String      | name_property                                              | Yes         |\n| cookbook       | String      | 'pdns'                                                     | No          |\n| source         | String      | 'authoritative.init.debian.erb'                            | No          |\n| config_dir     | String      | See `default_authoritative_config_directory` helper method | Yes         |\n| socket_dir     | String      | \"/var/run/#{instance_name}\"                                | Yes         |\n| variables      | Hash        | {}                                                         | No          |\n\n#### Usage example\n\n```\npdns_authoritative_service 'server_01' do\n  action [:enable, :start]\nend\n```\n\n### pdns_recursor_install\n\nInstalls PowerDNS recursor 4.X series using PowerDNS official repository in the supported platforms.\n\n#### Properties\n\n| Name           | Class       |  Default value  | Consistent? |\n|----------------|-------------|-----------------|-------------|\n| version        | String      | name_property   | Yes         |\n| debug          | True, False | String, nil     | No          |\n\n#### Usage Example\n\nInstall a 4. powerdns instance named 'my_recursor' on ubuntu 14.04:\n\n    pdns_recursor_install 'my_recursor' do\n      version '4.0.4-1pdns.trusty'\n    end\n\n### pdns_recursor_service\n\nSets up a PowerDNS recursor instance using the appropiate init system .\n\n*Important:* services not restarted or reloaded automatically on config changes in this cookbook, you need to add this in your wrapper cookbook if you desire this functionality, the `pdns_recursor_service` cookbook provides actions to do it.\n\n\n#### Properties\n\n| Name           | Class      |  Default value                                        | Consistent? |\n|----------------|------------|-------------------------------------------------------|-------------|\n| instance_name  | String     | name_property                                         | Yes         |\n| config_dir     | String     | see `default_recursor_config_directory` helper method | Yes         |\n| cookbook (SysVinit)      | String,nil | 'pdns'                                                | No          |\n| source  (SysVinit)       | String,nil | 'recursor.init.#{node['platform_family']}.erb'                            | No          |\n| variables (SysVinit)    | Hash     | {} | No     |\n\n- `config_dir`: Path of the recursor configuration directory.\n- `cookbook`: Cookbook for a custom configuration template (Applied only when using SysVinit).\n- `source`: Name of the recursor custom template (Applied only when using SysVinit).\n- `variables`: Variables hash to pass to the sysvinit template\n\n#### Usage Example\n\nConfigure a PowerDNS recursor service instance named 'my_recursor' in your wrapper cookbook for Acme Corp with a custom template named `my-recursor.erb`\n\n    pdns_recursor_service 'my_recursor' do\n      source 'my-recursor.erb'\n      cookbook 'acme-pdns-recursor'\n    end\n\n### pdns_recursor_config\n\nCreates a PowerDNS recursor configuration.\n\n#### Properties\n\n|           | Name           | Class       |  Default value                                         | Consistent? |\n|----------------|-------------|--------------------------------------------------------|-------------|\n| instance_name  | String      | name_property                                          | Yes         |\n| config_dir     | String      | see `default_recursor_config_directory` helper method  | Yes         |\n| socket_dir     | String      | /var/run/#{resource.instance_name}                     | Yes         |\n| run_group      | String      | see `default_recursor_run_user` helper method          | No          |\n| run_user       | String      | see `default_recursor_run_user` helper method          | No          |\n| run_user_home  | String      | see `default_user_attributes` helper method            | No          |\n| run_user_shell | String      | see `default_user_attributes` helper method            | No          |\n| setuid         | String      | resource.run_user                                      | No          |\n| setgid         | String      | resource.run_group                                     | No          |\n| source         | String, nil | 'recursor_service.conf.erb'                            | No          |\n| cookbook       | String, nil | 'pdns'                                                 | No          |\n| variables      | Hash        | {}                                                     | No          |\n\n- `config_dir` (C): Path of the recursor configuration directory.\n- `socket_dir` (C): Directory where sockets are created.\n- `source` (C): Name of the recursor custom template.\n- `socket_dir` (C): Directory where sockets are created.\n- `cookbook` (C): Cookbook for a custom configuration template\n- `variables`: Variables for the configuration template.\n- `run_group`: Unix group that runs the recursor.\n- `run_user`: Unix user that runs the recursor.\n- `run_user_home`: Home of the Unix user that runs the recursor.\n- `run_user_shell`: Shell of the Unix user that runs the recursor.\n\n#### Usage Example\n\nCreate a PowerDNS recursor configuration named 'my_recursor' in your wrapper cookbook for Acme Corp which uses a custom template named `my-recursor.erb` and a few attributes:\n\n    pdns_recursor_config 'my_recursor' do\n      source 'my-recursor.erb'\n      cookbook 'acme-pdns-recursor'\n      variables(client-tcp-timeout: '20', loglevel: '5', network-timeout: '2000')\n    end\n\n#### Virtual Hosting\n\nPowerDNS supports virtual hosting: running many instances of PowerDNS on different ports on the same machine. This is done by a few clever hacks on the init scripts that allow to specify different config files for each instance. This cookbook leverages this functionality in both recursor and authoritative.\n\n[PowerDNS recommends a specific naming schema](https://doc.powerdns.com/md/authoritative/running/) authoritative for virtual hosting. Specifically it does not allow hyphens (-) on the init scripts beyond the first which is provided by the init script (`/etc/init.d/pdns-`).\n\nWe have adopted the convention of using underscores (_) in the name attributes of underscores in order to comply with this requirement.\n\n## Contributing\n\nThere is an specific file for contributing guidelines on this cokbook: CONTRIBUTING.md\n\n## Testing\n\nThere is an specific file for testing guidelines on this cokbook: TESTING.md\n\n\nLicense & Authors\n-----------------\n- Author:: Aaron Kalin (<aaron.kalin@dnsimple.com>)\n- Author:: Jacobo García (<jacobo.garcia@dnsimple.com>)\n- Author:: Anthony Eden (<anthony.eden@dnsimple.com>)\n\n```text\nCopyright:: 2010-2014, Chef Software, Inc & 2014-2016 Aetrion, LLC.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n```\n","maintainer":"Aetrion, LLC DBA DNSimple","maintainer_email":"ops@dnsimple.com","license":"Apache-2.0","platforms":{"ubuntu":">= 14.04","debian":">= 8.0","centos":">= 6.0","redhat":">= 6.0"},"dependencies":{"apt":">= 0.0.0"},"recommendations":{},"suggestions":{},"conflicting":{},"providing":{},"replacing":{},"attributes":{},"groupings":{},"recipes":{},"source_url":"https://github.com/dnsimple/chef-pdns","issues_url":"https://github.com/dnsimple/chef-pdns/issues","chef_version":[[">= 12.14"]],"ohai_version":[]}