{
  "name": "proxysql",
  "description": "Installs/Configures ProxySQL",
  "long_description": "# ProxySQL Chef cookbook\n\nProxySQL is a high performance, high availability, protocol aware proxy\nfor MySQL and forks (like Percona Server and MariaDB).\n\n> Note: due to rapid ProxySQL development, locked ProxySQL version may not be available, therefore one might need to bump version `node['proxysql']['version']`.\n\n[![Build Status](https://travis-ci.org/ernestas-poskus/chef-proxysql.svg?branch=master)](https://travis-ci.org/ernestas-poskus/chef-proxysql)\n[![Cookbook Version](https://img.shields.io/cookbook/v/proxysql.svg)](https://supermarket.chef.io/cookbooks/proxysql)\n\nCookbook configures any number of ProxySQL instances, each instance has\nisolated configuration. ProxySQL instance is installed through Chef\nresource `protocol_service`.\n\nInstances are configured through node['proxysql'] attributes and/or\n`proxysql_*` block arguments. See the examples below.\n\nEach ProxySQL is automatically managed by Chef, on disk configuration\nchanges are propagated to instance admin and are loaded to runtime.\nCookbook propagates these SQL statements to load configuration.\n\n```sql\nLOAD MYSQL USERS FROM CONFIG\nLOAD MYSQL USERS TO RUNTIME\nLOAD MYSQL SERVERS FROM CONFIG\nLOAD MYSQL SERVERS TO RUNTIME\nLOAD MYSQL QUERY RULES FROM CONFIG\nLOAD MYSQL QUERY RULES TO RUNTIME\nLOAD MYSQL VARIABLES FROM CONFIG\nLOAD MYSQL VARIABLES TO RUNTIME\nLOAD ADMIN VARIABLES FROM DISK\nLOAD ADMIN VARIABLES TO RUNTIME\n```\n\n## Design\n\nThere are 5 special `proxysql_service` resource attributes.\n\n```\n# mysql_servers Hash\n# mysql_users Hash\n# mysql_query_rules Hash\n# schedulers Hash\n# mysql_replication_hostgroups Hash\n```\n\nEach attribute must be of type Hash (validated) and\nassociated key value must be Array (validated).\nThis structure allows merging node,role,data_bag overrides into\nsingle one.\n\nFor example given.:\n\n```json\n{\n  \"name\": \"datacenter1\",\n  \"override_attributes\": {\n    \"proxysql\": {\n      \"config\": {\n        \"mysql_servers\": {\n          \"dc1\": [\n            { \"address\": \"/var/lib/mysql/mysql.sock\", \"hostgroup\": 1 }\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\n```json\n{\n  \"name\": \"datacenter2\",\n  \"override_attributes\": {\n    \"proxysql\": {\n      \"config\": {\n        \"mysql_servers\": {\n          \"dc2\": [\n            { \"address\": \"127.0.0.1\", \"port\": 21892 , \"hostgroup\": 1 }\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\nThese two roles `datacenter1` and `datacenter2` attributes will be merged\nso the final `CNF` configuration will be.\n\n```cnf\nmysql_servers=(\n{\n  address=\"/var/lib/mysql/mysql.sock\"\n  hostgroup=1\n},\n{\n  address=\"127.0.0.1\"\n  port=21892\n  hostgroup=1\n}\n)\n```\n\n## Installation\n\nCookbook assumes `monitor` user is created on each database server.\n\nInclude this line in metadata.rb\n\n```ruby\ndepends 'proxysql'\n```\n\nThere are 2 ways to use this cookbook resources.\n\n1. Include default recipe and manipulate node['proxysql'] attributes.\n\n```ruby\ninclude_recipe 'proxysql::default'\n```\n\n2. Use resource in any recipe.\n\n```ruby\nproxysql_service 'default' do\n  # ...\nend\n```\n\n## Requirements\n\n - Systemd\n - MySQL client (for loading configuration from disk to proxysql)\n\n## Resources\n\n```ruby\nproxysql_service 'any name' do\n  # service_name 'proxysql-eu1'\n  # user String\n  # group String\n  # data_dir String\n  # config_dir String\n  # version String\n  # bin String\n  # admin_socket [String, NilClass]\n  # flags Hash\n  # admin_variables Hash\n  # mysql_variables Hash\n  # mysql_servers Hash\n  # mysql_users Hash\n  # mysql_query_rules Hash\n  # schedulers Hash\n  # mysql_replication_hostgroups Hash\n  # service_name String\n  # service_unit_after Array\n  # service_install_wanted_by Array\n  # service_restart String\n  # service_restart_sec Integer\nend\n```\n\n```ruby\nproxysql_admin_config 'eu1' do\n  # user String\n  # group String\n  # data_dir String\n  # config_dir String\n  # admin_username String\n  # admin_password String\n  # admin_hostname String\n  # admin_port Integer\n  # cluster_username String\n  # cluster_password String\n  # cluster_hostname String\n  # cluster_port Integer\n  # monitor_username String\n  # monitor_password String\n  # application_username String\n  # application_password String\n  # read_hostgroup_id String\n  # write_hostgroup_id String\n  # read_write_mode String\nend\n```\n\n## Attributes\n\n```ruby\ndefault['proxysql']['version'] = '1.4.7'\n\ndefault['proxysql']['user'] = 'proxysql'\ndefault['proxysql']['group'] = 'proxysql'\n\ndefault['proxysql']['config_dir'] = '/etc/proxysql'\ndefault['proxysql']['data_dir'] = '/var/lib/proxysql'\n\ndefault['proxysql']['service']['flags'] = {\n  'exit-on-error' => false,\n  'no-monitor' => false,\n  'no-start' => false,\n  'reuseport' => true,\n  'idle-threads' => true,\n  'initial' => false,\n  'reload' => false,\n  'sqlite3-server' => false\n}\n\ndefault['proxysql']['config']['admin_variables'] = {}\ndefault['proxysql']['config']['mysql_variables'] = {}\n\n# Special node attributes must be in a form of:\n# {\n#   \"string\": [objects]\n# }\n# Hash key \"string\" must be of type String it is necessary for support\n# of multiple attributes, hash values then are merged into 1 and\n# gets casted to CNF.\ndefault['proxysql']['config']['mysql_servers'] = {}\ndefault['proxysql']['config']['mysql_users'] = {}\ndefault['proxysql']['config']['mysql_query_rules'] = {}\ndefault['proxysql']['config']['schedulers'] = {}\ndefault['proxysql']['config']['mysql_replication_hostgroups'] = {}\n```\n\n## Examples\n\n```ruby\npass = 'suchsecret'\nfirst_port = 3300\nsecond_port = 3301\n\nservers = {\n  '2mysql' => [\n    {\n      address: '127.0.0.1',\n      'port' => first_port,\n      hostgroup: 1,\n      'max_connections' => 200\n    },\n    {\n      'address' => '127.0.0.1',\n      'port' => second_port,\n      'hostgroup' => 1\n    }\n  ]\n}\n\nusers = {\n  '2mysql' => [\n    {\n      username: 'root',\n      password: pass,\n      default_hostgroup: 2,\n      'active' => 1\n    }\n  ]\n}\n\nadmin_variables = {\n  admin_credentials: 'admin:admin',\n  'mysql_ifaces' => '127.0.0.1:6032'\n}\n\nvariables = {\n  'monitor_username' => 'monitor',\n  'monitor_password' => 'monitor'\n}\n\nproxysql_service '2balance' do\n  service_name 'proxysql-2balance'\n  admin_variables admin_variables\n  mysql_servers servers\n  mysql_users users\n  mysql_variables variables\nend\n```\n\n## License\n\nBSD 3-Clause License\n\nCopyright (c) 2017, Ernestas Poskus\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n* Redistributions of source code must retain the above copyright notice, this\n  list of conditions and the following disclaimer.\n\n* Redistributions in binary form must reproduce the above copyright notice,\n  this list of conditions and the following disclaimer in the documentation\n  and/or other materials provided with the distribution.\n\n* Neither the name of the copyright holder nor the names of its\n  contributors may be used to endorse or promote products derived from\n  this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\nOR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nAuthor Information\n------------------\n\n - Blog: [http://out13.com/](http://out13.com/)\n - Twitter: @ernestas_poskus\n",
  "maintainer": "Ernestas Poskus",
  "maintainer_email": "ernestas.poskus@gmail.com",
  "license": "MIT",
  "platforms": {
    "redhat": ">= 0.0.0",
    "centos": ">= 0.0.0",
    "ubuntu": ">= 0.0.0",
    "debian": ">= 0.0.0"
  },
  "dependencies": {
    "poise": "~> 2.8.1",
    "poise-service": "~> 1.5.2"
  },
  "providing": {

  },
  "attributes": {

  },
  "recipes": {

  },
  "version": "2.2.1",
  "source_url": "https://github.com/ernestas-poskus/chef-proxysql",
  "issues_url": "https://github.com/ernestas-poskus/chef-proxysql/issues",
  "privacy": false,
  "chef_versions": [
    [
      ">= 12.1"
    ]
  ],
  "ohai_versions": [

  ],
  "gems": [

  ]
}
