{"name":"sql_server","version":"5.5.0","description":"Installs/Configures Microsoft SQL Server","long_description":"# sql_server Cookbook\n\n[![AppVeyor Build status](https://ci.appveyor.com/api/projects/status/ww3v5xdery9ha972/branch/master?svg=true)](https://ci.appveyor.com/project/ChefWindowsCookbooks/sql-server/branch/master) [![Cookbook Version](https://img.shields.io/cookbook/v/sql_server.svg)](https://supermarket.chef.io/cookbooks/sql_server)\n\nProvides resources for the installation and configuration of Microsoft SQL Server server and client. Includes several basic recipes that utilize install and configure resources. See the usage section below for more information.\n\n## Requirements\n\n### Platforms\n\n- Windows Server 2008 R2 (SP2)\n- Windows Server 2012 (R1, R2)\n\nNOTE: Install of SQL Server 2016 and SQL Server 2017 is not supported on Server 2008 R2\n\n### Supported Server Verions\n\n- Microsoft SQL Server 2008 R2\n- Microsoft SQL Server 2012\n- Microsoft SQL Server 2014\n- Microsoft SQL Server 2016\n- Microsoft SQL Server 2017\n\n### Supported Client Versions\n\n- Microsoft SQL Server 2008 R2\n- Microsoft SQL Server 2012\n\n### Chef\n\n- Chef 12.7+\n\n### Cookbooks\n\n- windows\n\n## Resources\n\n### sql_server_install\n\n#### Actions\n\n- `:install` - Installs the version of Microsoft SQL server specified. Default install is SQL 2012 Express. \n\n#### Properties\n\n- `feature` - An Array of the SQL Instance or Server features that are going to be enabled / installed.\n   - [SQL 2012 Available Features list](https://technet.microsoft.com/library/cc645993(SQL.110).aspx)\n      - Instance Features\n         - `SQLENGINE` = Database Engine\n         - `REPLICATION` = Replication \n         - `FULLTEXT` = Full-Text and Semantic Extractions for search\n         - `DQ` = Data Quality Services\n         - `AS` = Analysis Services\n         - `RS` = Reporting Services - Native\n      - Shared Features\n         - `RS_SHP` = Reporting Services - SharePoint\n         - `RS_SHPWFE` = Reporting Services Add-in for SharePoint Products\n         - `DQC` = Data Quality Client\n         - `BIDS` = SQL Server data tools\n         - `CONN` = Client tools connectivity \n         - `IS` = Integration Services\n         - `BC` = Client tools backwards compatibility\n         - `SDK` = Client tools SDK\n         - `BOL` = Documentation components\n         - `SSMS` = Management tools\n         - `SSMS_ADV` = Management tools - Advanced\n         - `DREPLAY_CTLR` = Distributed replay controller \n         - `DREPLAY_CLT` = Distributed replay client \n         - `SNAC_SDK` = SQL client connectivity SDK\n    - [SQL 2014 Available Features list](https://technet.microsoft.com/library/cc645993(SQL.120).aspx)\n       - Instance Features\n          SAME AS 2012\n       - Shared Features\n         - REMOVED for standalone install\n           - `BIDS` = SQL Server data tools\n    - [SQL 2016 Available Features list](https://technet.microsoft.com/library/cc645993(SQL.130).aspx)\n       - Instance Features\n          - `ADVANCEDANALYTICS` = R Services (In-Database)\n          - `POLYBASE` = PolyBase Query Service for External Data\n             Note: This Feature Requires Java Runtime Environment greater than 7 update 51. Only the standalone Polybase-enabled Instance is currently support by this cookbook.\n       - Shared Features\n          - `SQL_SHARED_MR` = R Server (Standalone)\n          - `MDS` = Master Data Services\n          - REMOVED for standalone install\n             - `SSMS` = Management tools\n             - `SSMS_ADV` = Management tools - Advanced\n    - [SQL 2017 Available Features list](https://docs.microsoft.com/en-us/sql/sql-server/editions-and-components-of-sql-server-2017)\n       - Instance Features\n          - `ADVANCEDANALYTICS` = Machine Learning services (In-Database)\n             - `SQL_INST_MPY` = Machine Learning services (In-Database) with Python\n             - `SQL_INST_MR` = Machine Learning services (In-Database) with R\n       - Shared Features\n          - `SQL_SHARED_AA` = Machine Learning Services (Standalone)\n             - `SQL_SHARED_MR` = Machine Learning services (In-Database) with R\n             - `SQL_SHARED_MPY` = Machine Learning services (In-Database) with Python\n          - `IS` = Integrated Services\n             - `IS_MASTER` - Scale Out Master\n             - `IS_WORKER` - Scale Out Worker\n\n\n- `version` - Version of SQL to be installed. Valid otpions are `2008`, `2008R2`, `2012`, `2014`, `2016`, or `2017`. Default is `2012`\n- `source_url` - Source of the SQL setup.exe install file. Default is built from the helper libraries.\n- `package_name` - Package name for the SQL install. If you specify a version this property is not necessary. Default is built from the helper libraries.\n- `package_checksum` - Package checksum in SHA256 format for the setup.exe file. Default is built from the helper libraries.\n- `sql_reboot` - Determines whether the node will be rebooted after the SQL Server installation. Default setting is true\n- `security_mode` - The Autentication mode for SQL. Valid options are `Windows Athentication` or `Mixed Mode Authentication`. Default value is `Windows Authentication`\n- `sa_password` - The SQL Administrator password when `Mixed Mode Authentication` is being used. SQL enforces a strong passwords for this value.\n- `sysadmins` - The list of Systems Administrators who can access the SQL Instance. This can either be a String or an Array.\n- `agent_account` - The Service Account that will be used to run the SQL Agent Service. Default is `NT AUTHORITY\\SYSTEM`.\n- `agent_startup` - The Agent Service startup type. Valid options are `Automatic`, `Manual`, `Disabled`, or `Automatic (Delayed Start)`. Default is `Disabled`.\n- `agent_account_pwd` - Agent Service Account password.\n- `sql_account` - Service Account used to run the SQL service. Default is `NT AUTHORITY\\NETWORK SERVICE`\n- `sql_account_pwd` - Service Account password for the SQL service account.\n- `browser_startup` - Service startup type for the SQL Browser Service. Valid options are `Automatic`, `Manual`, `Disabled`, or `Automatic (Delayed Start)`. Default is `Disabled`.\n- `installer_timeout` - Time out for the SQL installation. Default is `1500`\n- `accept_eula` - Whether or not to accept the end user license agreement. Default is `false`\n   Note: For SQL 2016 if this will also accept the license for using R if `ADVANCEDANALYTICS` or `SQL_SHARED_MR` is listed in the feature property array.\n- `product_key` - Product key for not Express or Evaluation versions.\n- `update_enabled` - Whether or not to download updates during install. Default is true.\n- `update_source` - The Source Location of Windows Update or WSUS. Default is `MU`. Example = `c:/path/to/update`\n- `instance_name` - Name for the instance to be installed. Default is `SQLEXPRESS`. For non-express installs that want the default install it should be set to `MSSQLSERVER`.\n- `install_dir` - Directory SQL binaries will be installed to. Default is `C:\\Program Files\\Microsoft SQL Server`\n- `instance_dir` - Directory the Instance will be stored. Default is `C:\\Program Files\\Microsoft SQL Server`\n- `sql_data_dir` - Directory for SQL data\n- `sql_backup_dir` - Directory for backups\n- `sql_user_db_dir` - Directory for the user database\n- `sql_user_db_log_dir`  - Directory for the user database logs\n- `sql_temp_db_dir` - Directory for the temporary database\n- `sql_temp_db_log_dir` - Directory for the temporary database logs\n- `filestream_level` - Level to enable the filestream feature, Valid values are 0, 1, 2 or 3. Default is 0\n- `filestream_share_name` - Share name for the filestream feature. Default is `MSSQLSERVER`\n- `sql_collation` - SQL Collation type for the instance\n- `netfx35_install` - If the .Net 3.5 Windows Feature is installed. This is required to successfully install SQL 2012 and 2014. Default is true.\n- `netfx35_source` - Source location for the .Net 3.5 Windows Features install. Only required for offline installs\n\nDistributed Replay\n- `dreplay_ctlr_admins` - List of admins for the Distributed Replay Controller. Default is `Administrator`. The `DREPLAY_CTLR` feature needs to be included in the feature Array for this property to work.\n- `dreplay_client_name` - Host name of the Distributed Replay Controller that the Client will point to. If the `DREPLAY_CLT` is in the feature list this property needs to be set.\n\nReporting Services\n- `rs_account` - Service Account name used to run SQL Reporting Services. To have reporting services it needs to be listed in the `feature` property array.\n- `rs_account_pwd` - Service Account password for the Reporting Services Service\n- `rs_startup` - Reporting Services service startup type. Valid options are `Automatic`, `Manual`, `Disabled`, or `Automatic (Delayed Start)`. Default is `Automatic`.\n- `rs_mode` - Mode the Reporting Services is installed in. Default is `FilesOnlyMode`\n\nAnalysis Services\n- `as_sysadmins` - Analysis Services Systems Administrator list. Default is `Administrator`\n\nPolyBase Query Services\n- `polybase_port_range` - Port Range for the PolyBase Query Service. Default is `16450-16460`.\n\nIntegrated Services\n- `is_master_port` - Port for the Integrated Services Scale out Master. Default is 8391.\n- `is_master_ssl_cert` - The CNs in the certificate used to protect communications between the integration services scale out worker and scale out master.\n- `is_master_cert_thumbprint` - The certificate thumbprint for the scale out master ssl certificate.\n- `is_worker_master_url` - The url of the scale out master when installing a scale out worker.\n\n#### Examples\n\nInstall SQL 2012 Express with all the defaults\n\n```ruby\nsql_server_install 'Install SQL 2012 Express'\n```\n\nInstall SQL 2014 Express\n\n```ruby\nsql_server_install `Install SQL 2014 Express` do\n  version '2014'\nend\n```\n\nInstall SQL 2014 Evaluation from a local source with default instance name, Integrated Services, Reporting Services, and the SQL Management Tools.\n\n```ruby\nsql_server_install `Install SQL Server 2014 Evaluation` do\n  source_url 'C:\\\\Sources\\\\SQL 2014 Eval\\\\setup.exe'\n  version '2014'\n  package_checksum '0FE903...420E8F'\n  accept_eula true\n  instance_name 'MSSQLSERVER'\n  feature %w(SQLENGINE IS RS SSMS ADV_SSMS)\nend\n```\n\n### sql_server_configure\n\n#### Actions\n\n- `:service` - Configures the ports that SQL be listening on and starts and enables the SQL Service.\n\n#### Properties\n\n- `version` - SQL Version of the instance to be configured. Valid otpions are `2008`, `2008R2`, `2012`, `2014`, `2016`, or `2017`. Default is `2012`\n- `tcp_enabled` - If TCP is enabled for the instance. Default is true\n- `sql_port` - Port SQL will listen on. Default is 1433\n- `tcp_dynamic_ports` - Sets the Dynamic port SQL will listen on. Default is an empty string\n- `np_enabled` - Whether named pipes is enabled. Default is false\n- `sm_enabled` - Whether shared memory is enabled for the instance\n- `via_default_port` - Configures the Virtual Interface Adapter default port. Default is `0:1433`\n- `via_enabled` - Whether Virtual Interface Adapter is enabled. Default is false\n- `via_listen_info` - Configures the Virtual interface listening information. Default is `0:1433`\n- `agent_startup` - Configures the SQL Agent Service startup type. Valid options are `Automatic`, `Manual`, `Disabled`, or `Automatic (Delayed Start)`. Default is `Disabled` \n\n#### Examples\n\nConfigure a SQL 2012 Express install with all the defaults\n\n```ruby\nsql_server_configure `SQLEXPRESS`\n```\n\nConfigure a SQL 2014 Express install\n\n```ruby\nsql_server_configure `SQLEXPRESS` do\n  version '2014'\nend\n```\n\nConfigure a SQL 2014 Evaluation install with a different port\n\n```ruby\nsql_server_configure 'MSSQLSERVER' do\n  version '2014'\n  sql_port '1434'\nend\n```\n\n## Attributes\n\n### default\n\nThe following attributes are used by both client and server recipes.\n\n- `node['sql_server']['accept_eula']` - indicate that you accept the terms of the end user license, default is 'false'\n- `node['sql_server']['product_key']` - Specifies the product key for the edition of SQL Server, default is `nil` (not needed for SQL Server Express installs)\n\n### client\n\nThis file also contains download url, checksum and package name for all client installation packages. See the **Usage** section below for more details.\n\n### server\n\n- `node['sql_server']['install_dir']` - main directory for installation, default is `C:\\Program Files\\Microsoft SQL Server`\n- `node['sql_server']['instance_name']` - name of the default instance, default is `SQLEXPRESS`\n- `node['sql_server']['instance_dir']` - root directory of the default instance, default is `C:\\Program Files\\Microsoft SQL Server`\n- `node['sql_server']['shared_wow_dir']` - root directory of the shared WOW directory, default is `C:\\Program Files (x86)\\Microsoft SQL Server`\n- `node['sql_server']['agent_account']` - Agent account name, default is `NT AUTHORITY\\NETWORK SERVICE`\n- `node['sql_server']['agent_startup']` - Agent service startup mode, default is `Disabled`\n- `node['sql_server']['rs_mode']` - Reporting Services install mode, default is `FilesOnlyMode`\n- `node['sql_server']['rs_account']` - Reporting Services account name, default is `NT AUTHORITY\\NETWORK SERVICE`\n- `node['sql_server']['rs_startup']` - Reporting Services startup mode, default is `Automatic`\n- `node['sql_server']['browser_startup']` - Browser Service startup mode, default is `Disabled`\n- `node['sql_server']['sysadmins']` - Windows accounts that are SQL administrators, default is `Administrator`\n- `node['sql_server']['sql_account']` - SQL service account name, default is `NT AUTHORITY\\NETWORK SERVICE`\n\nThis file also contains download url, checksum and package name for the server installation package.\n\n### configure\n\n- `node['sql_server']['tcp_enabled']` - Enables TCP listener, default is `true`\n- `node['sql_server']['port']` - Static TCP port server should listen on for client connections, default is `1433`\n- `node['sql_server']['tcp_dynamic_ports']` - Dynamic TCP ports server should listen on for client connections, default is `''`\n- `node['sql_server']['np_enabled']` - Enables Named pipes listener, default is `false`\n- `node['sql_server']['sm_enabled']` - Enables Shared Memory listener, default is `true`\n- `node['sql_server']['via_default_port']` - VIA default listener port, default is `0:1433`\n- `node['sql_server']['via_enabled']` - Enables VIA listener, default is `false`\n- `node['sql_server']['via_listen_info']` - VIA listener info, default is `0:1433`\n\n## Recipe Usage\n\nWe highly recommend writing your own wrapper cookbook utilizing the above resources, but this cookbook also ships with legacy recipes that can be used to install sql_server using recipes/attributes.\n\n### default\n\nIncludes the `sql_server::client` recipe.\n\n### client\n\nInstalls required the SQL Server Native Client and all required dependencies. These include:\n\n- [Microsoft SQL Server 2008 R2 Native Client](http://www.microsoft.com/download/en/details.aspx?id=16978#SNAC)\n- [Microsoft SQL Server 2008 R2 Command Line Utilities (ie `sqlcmd`)](http://www.microsoft.com/download/en/details.aspx?id=16978#SQLCMD)\n- [Microsoft SQL Server System CLR Types](http://www.microsoft.com/download/en/details.aspx?id=16978#SQLSYSCLR)\n- [Microsoft SQL Server 2008 R2 Management Objects](http://www.microsoft.com/download/en/details.aspx?id=16978#SMO)\n- [Windows PowerShell Extensions for SQL Server 2008 R2](http://www.microsoft.com/download/en/details.aspx?id=16978#PowerShell)\n\nThe SQL Server Native Client contains the SQL Server ODBC driver and the SQL Server OLE DB provider in one native dynamic link library (DLL) supporting applications using native-code APIs (ODBC, OLE DB and ADO) to Microsoft SQL Server. In simple terms these packages should allow any other node to act as a client of a SQL Server instance.\n\n### configure\n\nConfigures SQL Server registry keys via attributes, and restart the Engine service if required.\n\nCurrent supported settings are mostly connection listeners:\n\n- TCP or VIA listener ports\n- TCP, Named Pipes, Shared Memory or VIA listener activation.\n\nNOTE: It could be very dangerous to change these settings on a production server!\n\nThis recipe is included by the `sql_server::server` recipe, but can be included independently if you setup SQL Server by yourself.\n\n### server\n\nInstalls SQL Server 2008 R2 Express, SQL Server 2012 Express, SQL Server 2014 Express, or SQL Server 2016 Express.\n\nBy default, the cookbook installs SQL Server 2012 Express. There are two options to install a different version.\n\nNOTE: For this recipe to run you must set the following attributes in an environment, role, or wrapper cookbook.\n\n`node['sql_server']['agent_account_pwd']`<br>\n`node['sql_server']['rs_account_pwd']`<br>\n`node['sql_server']['sql_account_pwd']`\n\nNOTE: This recipe will request a reboot at the end of the Chef Client run if SQL Server was installed.. If you do not want to reboot after the installation, use the `reboot` resource to cancel the pending reboot.\n\n**Option 1:** From a role, environment, or wrapper cookbook, set `node['sql_server']['version']` to '2008R2' to install SQL Server 2008 R2 Express, '2012' to install SQL Server 2012 Express, '2014' to install SQL Server 2014 Express, or '2016' to install SQL Server 2016 Express.\n\n**Option 2:** From a role, environment, or wrapper cookbook, set these node attributes to specify the URL, checksum, and name of the package (as it appears in the Windows Registry).\n\n```\nnode['sql_server']['server']['url']\nnode['sql_server']['server']['checksum']\nnode['sql_server']['server']['package_name']\n```\n\nThe installation is done using the `package` resource and [ConfigurationFile](http://msdn.microsoft.com/en-us/library/dd239405.aspx) generated from a `template` resource. The installation is slightly opinionated and does the following:\n\n- Enables [Mixed Mode](http://msdn.microsoft.com/en-us/library/aa905171\\(v=sql.80\\).aspx) (Windows Authentication and SQL Server Authentication) authentication\n- sets a static TCP port which is configurable via an attribute, using the `sql_server::configure` recipe.\n\nInstalling any of the SQL Server server or client packages in an unattended/automated way requires you to explicitly indicate that you accept the terms of the end user license. The hooks have been added to all recipes to do this via an attribute. Create a role to set the `node['sql_server']['accept_eula']` attribute to 'true'. For example:\n\n```ruby\nname \"sql_server\"\ndescription \"SQL Server database master\"\nrun_list(\n  \"recipe[sql_server::server]\"\n)\ndefault_attributes(\n  \"sql_server\" => {\n    \"accept_eula\" => true\n  }\n)\n```\n\nOut of the box this recipe installs the Express edition of SQL Server 2012\\. If you would like to install the Standard edition create a role as follows:\n\n```ruby\nname \"sql_server_standard\"\ndescription \"SQL Server Stadard edition database master\"\nrun_list(\n  \"recipe[sql_server::server]\"\n)\ndefault_attributes(\n  \"sql_server\" => {\n    \"instance_name\" => \"MSSQLSERVER\",\n    \"product_key\" => \"YOUR_PRODUCT_KEY_HERE\",\n    \"accept_eula\" => true,\n    \"server\" => {\n      \"url\" => \"DOWNLOAD_LOCATION_OF_INSTALLATION_PACKAGE\",\n      \"checksum\" => \"SHA256_OF_INSTALLATION_PACKAGE\"\n    }\n  }\n)\n```\n\nDepending on your base Windows installation you may also need to open the configured static port in the Windows Firewall. In the name of security we do not do this by default but the follow code should get the job done:\n\n```ruby\n# unlock port in firewall\n# this should leverage firewall_rule resource\n# once COOK-689 is completed\nfirewall_rule_name = \"#{node['sql_server']['instance_name']} Static Port\"\n\nexecute \"open-static-port\" do\n  command \"netsh advfirewall firewall add rule name=\\\"#{firewall_rule_name}\\\" dir=in action=allow protocol=TCP localport=#{node['sql_server']['port']}\"\n  returns [0,1,42] # *sigh* cmd.exe return codes are wonky\n  not_if { SqlServer::Helper.firewall_rule_enabled?(firewall_rule_name) }\nend\n```\n\n## Installing SQL Server remotely\n\nSQL Server does not support remote installation over WinRM. For example, the installation fails when you run `knife bootstrap windows winrm` or `knife winrm 'chef-client'` with a run-list that includes `server.rb`. However, you can use a scheduled task or run `chef-client` as a service.\n\n[Learn more](https://learn.chef.io/modules/create-a-web-app-cookbook/windows/virtualbox) in this Learn Chef tutorial.\n\n## License & Authors\n\n**Author:** Cookbook Engineering Team ([cookbooks@chef.io](mailto:cookbooks@chef.io))\n\n**Copyright:** 2011-2018, Chef Software, Inc.\n\n```text\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n```\n","maintainer":"Chef Software, Inc.","maintainer_email":"cookbooks@chef.io","license":"Apache-2.0","platforms":{"windows":">= 0.0.0"},"dependencies":{"windows":">= 3.0"},"recommendations":{},"suggestions":{},"conflicting":{},"providing":{},"replacing":{},"attributes":{},"groupings":{},"recipes":{},"source_url":"https://github.com/chef-cookbooks/sql_server","issues_url":"https://github.com/chef-cookbooks/sql_server/issues","chef_version":[[">= 12.7"]],"ohai_version":[]}