#
#  Dynamically generated by Chef on <%= node["fqdn"] %>
#  Local modifications will be overwritten by Chef.
#

db.pool.idle.testInterval=<%= @database['testInterval'] %>

<% case @database['type'] %>
<% when "hsqldb" %>
jdbc.driver=org.hsqldb.jdbcDriver
jdbc.url=jdbc:hsqldb:${stash.home}/data/db;shutdown=true
<% when "mysql" %>
jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://<%= @database['host'] == "localhost" && node['mysql']['bind_address'] != '0.0.0.0' ? node['mysql']['bind_address'] : @database['host'] %>:<%= @database['port'] %>/<%= @database['name'] %><%= @database['query_string'] %>
<% when "postgresql" %>
jdbc.driver=org.postgresql.Driver
jdbc.url=jdbc:postgresql://<%= @database['host'] %>:<%= @database['port'] %>/<%= @database['name'] %><%= @database['query_string'] %>
<% when "sqlserver" %>
jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver
jdbc.url=jdbc:sqlserver://<%= @database['host'] %>:<%= @database['port'] %>;databaseName=<%= @database['name'] %>;<%= @database['query_string'] %>
<% end %>
jdbc.user=<%= @database['user'] %>
jdbc.password=<%= @database['password'] %>

<% if @plugin && !@plugin.empty? -%>
# DEPRECATED: use properties instead
<% @plugin.each do |key, value| -%>
plugin.<%= key %>=<%= value %>
<% end -%>
<% end -%>

<% if @properties -%>
<% @properties.each do |key, value| -%>
<%= key %>=<%= value %>
<% end -%>
<% end -%>

<% if Chef::Version.new(node['stash']['version']) >= Chef::Version.new('5.0.0') %>
  <% if node['stash']['apache2'] %>
server.secure=true
server.scheme=https
server.proxy-name=<%= node['stash']['apache2']['virtual_host_alias'] %>
server.proxy-port=<%= node['stash']['apache2']['ssl']['port'] %>
  <% else %>
server.redirect-port=<%= node['stash']['apache2']['ssl']['port'] %>
  <% end %>
<% end %>

<% unless node['stash']['setup']['admin']['username'].empty? && node['stash']['setup']['admin']['password'].empty? && \
     node['stash']['setup']['admin']['email'].empty? %>
setup.sysadmin.username=<%= node['stash']['setup']['admin']['username'] %>
setup.sysadmin.password=<%= node['stash']['setup']['admin']['password'] %>
setup.sysadmin.emailAddress=<%= node['stash']['setup']['admin']['email'] %>
<% if node['stash']['setup']['admin']['displayname'].empty? %>
setup.sysadmin.displayname=<%= node['stash']['setup']['admin']['username'] %>
<% else %>
setup.sysadmin.displayname=<%= node['stash']['setup']['admin']['displayname'] %>
<% end %>
<% end %>

<% unless node['stash']['setup']['license'].empty? %>
setup.license=<%= node['stash']['setup']['license'] %>
<% end %>

setup.displayname=<%= node['stash']['setup']['displayname'] %>

server.port=<%= node['stash']['tomcat']['port'] %>