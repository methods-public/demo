# nrpe generated by poise-service for poise_service[nrpe]

description "nrpe"

start on runlevel [2345]
stop on runlevel [!2345]
expect fork
respawn
respawn limit 10 5
umask 022
chdir <%= @environment['DIRECTORY'] %>

script
exec /opt/chef/embedded/bin/ruby <<EOH
require 'etc'
ent = Etc.getpwnam("nrpe")
if Process.euid != ent.uid || Process.egid != ent.gid
  Process.initgroups(ent.name, ent.gid)
  Process::GID.change_privilege(ent.gid) if Process.egid != ent.gid
  Process::UID.change_privilege(ent.uid) if Process.euid != ent.uid
end
ENV["HOME"] = Dir.home("nrpe") rescue nil
exec(*["<%= @environment['PROGRAM'] %>", "-c", "<%= @environment['CONFIG_FILE'] %>", "-d"])
EOH
end script
