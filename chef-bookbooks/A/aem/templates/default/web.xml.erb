<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd">
<!-- Generated by Chef for <%= node[:fqdn] %>
 Local modifications will be overwritten. -->
<web-app>
  <display-name>Content Repository Extreme</display-name>

  <!-- BEGIN Proxy Configuration -->
  <context-param>
      <param-name>proxy.enabled</param-name>
      <param-value>false</param-value>
  </context-param>
  <context-param>
      <param-name>proxy.host</param-name>
      <param-value>proxy.company.com:80</param-value>
  </context-param>
  <context-param>
      <param-name>proxy.user</param-name>
      <param-value></param-value>
  </context-param>
  <context-param>
      <param-name>proxy.password</param-name>
      <param-value></param-value>
  </context-param>
  <context-param>
      <param-name>proxy.ntlm.host</param-name>
      <param-value></param-value>
  </context-param>
  <context-param>
      <param-name>proxy.ntlm.domain</param-name>
      <param-value></param-value>
  </context-param>
  <!-- END Proxy Configuration -->

  <!-- ====================================================================== -->
  <!-- W E B A P P  L I S T E N E R S                                         -->
  <!-- ====================================================================== -->
  <listener>
      <listener-class>com.day.commons.httpclient.impl.ProxyContextListener</listener-class>
  </listener>

  <listener>
      <!-- Releases all Derby resources when the webapp is undeployed.  -->
      <!-- See https://issues.apache.org/jira/browse/JCR-1301           -->
      <listener-class>
          org.apache.jackrabbit.j2ee.DerbyShutdown
      </listener-class>
  </listener>

  <!-- ====================================================================== -->
  <!-- L O G G I N G   S E R V L E T                                          -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>Logging</servlet-name>
    <description>The logging servlet configures the Log4J logging facility.</description>
    <servlet-class>com.day.crx.j2ee.LoggingServlet</servlet-class>

    <init-param>
      <param-name>log4j-config</param-name>
      <param-value>/WEB-INF/log4j.xml</param-value>
      <description>initial log4j configuration</description>
    </init-param>

    <load-on-startup>1</load-on-startup>
  </servlet>

  <!-- ====================================================================== -->
  <!-- R E P O S I T O R Y   S E R V L E T                                    -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>Repository</servlet-name>
    <description>repository servlet that starts the repository and registers it to JNDI.</description>
    <servlet-class>com.day.crx.j2ee.CRXRepositoryStartupServlet</servlet-class>

    <init-param>
      <param-name>bootstrap-config</param-name>
      <param-value>bootstrap.properties</param-value>
      <description>
          Property file that hold the same initialization properties than
          the init-params below. If a parameter is specified in both
          places the one in the bootstrap-config wins.
      </description>
    </init-param>

    <init-param>
      <param-name>repository-home</param-name>
      <param-value>crx-quickstart/repository</param-value>
      <description>the repository home</description>
    </init-param>

    <init-param>
      <param-name>repository-name</param-name>
      <param-value>crx</param-value>
      <description>Repository Name under which the repository is registered via JNDI/RMI</description>
    </init-param>

    <!--
        RMI configuration
    -->
    <!--
    <init-param>
      <param-name>rmi-port</param-name>
      <param-value>1234</param-value>
      <description>
        The RMI port for registering the repository in the RMI Registry.
        If equals 0, the default port is used. Omit this parameter to
        disable RMI server entirely.
      </description>
    </init-param>
    -->

    <!--
        JNDI environment variables
    -->
    <init-param>
      <param-name>java.naming.provider.url</param-name>
      <param-value>http://jcr.day.com</param-value>
    </init-param>
    <init-param>
      <param-name>java.naming.factory.initial</param-name>
      <param-value>com.day.util.jndi.provider.MemoryInitialContextFactory</param-value>
    </init-param>

    <load-on-startup>2</load-on-startup>

  </servlet>

  <!-- ====================================================================== -->
  <!-- J C R   E X P L O R E R  S E R V L E T                                 -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>JCRExplorer</servlet-name>
    <description>the content-repository explorer servlet</description>
    <servlet-class>com.day.crx.j2ee.JCRExplorerServlet</servlet-class>

    <init-param>
      <param-name>repository-name</param-name>
      <param-value>virtual-crx</param-value>
      <description>Repository Name that is used to retrieve it via JNDI</description>
    </init-param>

    <init-param>
      <param-name>explorer-home</param-name>
      <param-value>crx-quickstart/repository</param-value>
      <description>home directory of the explorer servlet</description>
    </init-param>

    <init-param>
      <param-name>crx-config</param-name>
      <param-value>/WEB-INF/crx.properties</param-value>
      <description>initial crx configuration</description>
    </init-param>

    <init-param>
      <param-name>docroot</param-name>
      <param-value>/docroot</param-value>
      <description>the docroot location</description>
    </init-param>

    <init-param>
      <param-name>temp-directory</param-name>
      <param-value>tmp</param-value>
      <description>the temp-directory location</description>
    </init-param>

    <!--
        RMI configuration

        <init-param>
            <param-name>rmi-uri</param-name>
            <param-value>//localhost:1099/crx</param-value>
        </init-param>
    -->

    <!--
        JNDI environment variables
    -->
    <init-param>
      <param-name>java.naming.provider.url</param-name>
      <param-value>http://jcr.day.com</param-value>
    </init-param>
    <init-param>
      <param-name>java.naming.factory.initial</param-name>
      <param-value>com.day.util.jndi.provider.MemoryInitialContextFactory</param-value>
    </init-param>

    <!--
        Checker properties
    -->
    <init-param>
      <param-name>checker-file</param-name>
      <param-value>checker.tmp</param-value>
    </init-param>

    <init-param>
      <param-name>checker-gif</param-name>
      <param-value>http://dev.day.com/crx.gif</param-value>
    </init-param>

    <init-param>
      <param-name>crx-update-url</param-name>
      <param-value>http://www.day.com/crx</param-value>
    </init-param>

    <init-param>
      <param-name>crx-support-email</param-name>
      <param-value>jcr@day.com</param-value>
    </init-param>

      <!-- crxde params -->
      <init-param>
        <param-name>launchpad.ctx.path</param-name>
        <param-value>/</param-value>
        <description>Context path of the launchpad</description>
      </init-param>

      <init-param>
        <!-- set timeout to 1 hour -->
        <param-name>session-timeout</param-name>
        <param-value>3600</param-value>
      </init-param>

    <load-on-startup>3</load-on-startup>
  </servlet>

  <!-- ====================================================================== -->
  <!-- N O D E T R E E   S E R V L E T                                        -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>NodeTree</servlet-name>
    <description>the node tree servlet for the NodeTree UI control</description>
    <servlet-class>com.day.ui.NodeTreeServlet</servlet-class>
  </servlet>

  <!-- ====================================================================== -->
  <!-- E X P O R T   S E R V L E T                                            -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>Export</servlet-name>
    <description>The export servlet is used to generate various export</description>
    <servlet-class>com.day.crx.j2ee.ExportServlet</servlet-class>
    <init-param>
      <param-name>export-prefix</param-name>
      <param-value>/export</param-value>
      <description>
        defines the prefix for this serlvet.
      </description>
    </init-param>
  </servlet>

  <!-- ====================================================================== -->
  <!-- W E B D A V  S E R V L E T                                              -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>Webdav</servlet-name>
    <description>
      The webdav servlet that connects HTTP request to the repository.
    </description>
    <servlet-class>com.day.crx.j2ee.ResourceServlet</servlet-class>

    <init-param>
      <param-name>resource-path-prefix</param-name>
      <param-value>/repository</param-value>
      <description>
        defines the prefix for spooling resources out of the repository.
      </description>
    </init-param>
    <!--
        Optional parameter to define the value of the 'WWW-Authenticate' header
    -->
    <init-param>
      <param-name>authenticate-header</param-name>
      <param-value>Basic realm="CRX Webdav Server"</param-value>
      <description>
        Defines the value of the 'WWW-Authenticate' header.
      </description>
    </init-param>
    <!--
        Parameter used to configure behaviour of webdav resources such as:
        - distinction between collections and non-collections
        - resource filtering
    -->
    <init-param>
      <param-name>resource-config</param-name>
      <param-value>/WEB-INF/config.xml</param-value>
      <description>
        Defines various dav-resource configuration parameters.
      </description>
    </init-param>
    <load-on-startup>4</load-on-startup>
  </servlet>

  <!-- ====================================================================== -->
  <!-- W E B D A V  S E R V E R  S E R V L E T                                  -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>JCRWebdavServer</servlet-name>
    <description>
      The webdav servlet that connects HTTP request to the repository.
    </description>
    <servlet-class>com.day.crx.j2ee.remoting.JcrRemotingServlet</servlet-class>

    <init-param>
      <param-name>resource-path-prefix</param-name>
      <param-value>/server</param-value>
      <description>
        defines the prefix for spooling resources out of the repository.
      </description>
    </init-param>
    <init-param>
      <param-name>missing-auth-mapping</param-name>
      <param-value></param-value>
    </init-param>
    <init-param>
      <param-name>home</param-name>
      <param-value>crx-quickstart</param-value>
      <description>Home directory for JcrRemotingServlet temporary files</description>
    </init-param>
    <init-param>
      <param-name>temp-directory</param-name>
      <param-value>server/tmp/remoting</param-value>
      <description>JcrRemotingServlet temporary directory name (under home)</description>
    </init-param>
    <load-on-startup>5</load-on-startup>
  </servlet>

  <!-- ====================================================================== -->
  <!-- CqResource  S E R V L E T                                              -->
  <!-- ====================================================================== -->
  <servlet>
    <servlet-name>CqResource</servlet-name>
    <servlet-class>org.apache.jackrabbit.j2ee.SimpleWebdavServlet</servlet-class>
    <init-param>
      <param-name>resource-path-prefix</param-name>
      <param-value>/cqresource</param-value>
    </init-param>
    <init-param>
      <param-name>resource-config</param-name>
      <param-value>/WEB-INF/cqresource.xml</param-value>
      <description>
        Defines various dav-resource configuration parameters.
      </description>
    </init-param>
    <load-on-startup>6</load-on-startup>
  </servlet>

    <!-- ====================================================================== -->
    <!-- P A C K A G E  S H A R E  S E R V L E T                                -->
    <!-- ====================================================================== -->
    <servlet>
      <servlet-name>PackageShare</servlet-name>
      <servlet-class>com.day.crx.packaging.impl.PackageShareServlet</servlet-class>
      <load-on-startup>6</load-on-startup>
    </servlet>

    <!-- ====================================================================== -->
    <!-- P A C K A G E  M A N A G E R  S E R V L E T                            -->
    <!-- ====================================================================== -->
    <servlet>
      <servlet-name>PackageManager</servlet-name>
      <servlet-class>com.day.crx.packaging.impl.PackageManagerServlet</servlet-class>
      <load-on-startup>6</load-on-startup>
    </servlet>

  <!-- ====================================================================== -->
  <!-- SMB  S E R V L E T                                                     -->
  <!-- ====================================================================== -->
  <!--
  <servlet>
    <servlet-name>SmbServlet</servlet-name>
    <servlet-class>com.day.crx.smb.SmbServlet</servlet-class>
    <init-param>
      <param-name>ip-address</param-name>
      <param-value>localhost</param-value>
    </init-param>
    <init-param>
      <param-name>port</param-name>
      <param-value>8445</param-value>
    </init-param>
    <init-param>
      <param-name>share</param-name>
      <param-value>crx</param-value>
    </init-param>
    <load-on-startup>7</load-on-startup>
  </servlet>
  -->

  <!-- ====================================================================== -->
  <!-- S E R V L E T   M A P P I N G                                          -->
  <!-- ====================================================================== -->
  <servlet-mapping>
    <servlet-name>NodeTree</servlet-name>
    <url-pattern>/ui/nodetree/*</url-pattern>
  </servlet-mapping>
  <% if node[:aem][:enable_webdav] %>
  <servlet-mapping>
    <servlet-name>Webdav</servlet-name>
    <url-pattern>/repository/*</url-pattern>
  </servlet-mapping>
  <servlet-mapping>
    <servlet-name>JCRWebdavServer</servlet-name>
    <url-pattern>/server/*</url-pattern>
  </servlet-mapping>
  <servlet-mapping>
    <servlet-name>CqResource</servlet-name>
    <url-pattern>/cqresource/*</url-pattern>
  </servlet-mapping>
  <% end %>
  <servlet-mapping>
    <servlet-name>Export</servlet-name>
    <url-pattern>/export/*</url-pattern>
  </servlet-mapping>
  <servlet-mapping>
    <servlet-name>PackageShare</servlet-name>
    <url-pattern>/packageshare/*</url-pattern>
  </servlet-mapping>
  <servlet-mapping>
    <servlet-name>PackageManager</servlet-name>
    <url-pattern>/packmgr/service/*</url-pattern>
  </servlet-mapping>
  <servlet-mapping>
    <servlet-name>JCRExplorer</servlet-name>
    <url-pattern>/</url-pattern>
  </servlet-mapping>

  <!-- ====================================================================== -->
  <!-- M I M E T Y P E   M A P P I N G                                          -->
  <!-- ====================================================================== -->
  <mime-mapping>
    <extension>doc</extension>
    <mime-type>application/msword</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>bin</extension>
    <mime-type>application/octet-stream</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>pdf</extension>
    <mime-type>application/pdf</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>ai</extension>
    <mime-type>application/postscript</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>eps</extension>
    <mime-type>application/postscript</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>ps</extension>
    <mime-type>application/postscript</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>rtf</extension>
    <mime-type>application/rtf</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>mif</extension>
    <mime-type>application/vnd.mif</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>ppt</extension>
    <mime-type>application/vnd.ms-powerpoint</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>vcd</extension>
    <mime-type>application/x-cdlink</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>js</extension>
    <mime-type>application/x-javascript</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>mp3</extension>
    <mime-type>audio/mpeg</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>ram</extension>
    <mime-type>audio/x-pn-realaudio</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>rm</extension>
    <mime-type>audio/x-pn-realaudio</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>ra</extension>
    <mime-type>audio/x-realaudio</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>gif</extension>
    <mime-type>image/gif</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>jpeg</extension>
    <mime-type>image/jpeg</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>jpg</extension>
    <mime-type>image/jpeg</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>png</extension>
    <mime-type>image/png</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>tiff</extension>
    <mime-type>image/tiff</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>tif</extension>
    <mime-type>image/tiff</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>css</extension>
    <mime-type>text/css</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>asc</extension>
    <mime-type>text/plain</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>txt</extension>
    <mime-type>text/plain</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>xml</extension>
    <mime-type>text/xml</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>html</extension>
    <mime-type>text/html</mime-type>
  </mime-mapping>
  <mime-mapping>
    <extension>htm</extension>
    <mime-type>text/html</mime-type>
  </mime-mapping>

  <!-- ====================================================================== -->
  <!-- W E L C O M E   F I L E S                                              -->
  <!-- ====================================================================== -->
  <welcome-file-list>
    <welcome-file>index.jsp</welcome-file>
  </welcome-file-list>

</web-app>
