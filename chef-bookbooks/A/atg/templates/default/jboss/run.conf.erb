# Generated by Chef for <%= node[:fqdn] %>
# JBoss run.conf script
# Addolux LLC
#
JAVA_HOME=<%= node['atg']['java_home'] %>
JBOSS_HOME=<%= node['atg']['app_home'] %>

[ "$JAVA_OPTS" ] || {
	JAVA_OPTS="$JAVA_OPTS -server"
	JAVA_OPTS="$JAVA_OPTS -Xms<%= @xms %> -Xmx<%= @xmx %> -XX:MaxPermSize=<%= @max_perm %> -XX:ThreadStackSize=<%= @threadstack %>"
	JAVA_OPTS="$JAVA_OPTS -XX:+UseParNewGC -XX:SurvivorRatio=12 -XX:+DisableExplicitGC -XX:+UseConcMarkSweepGC -XX:+CMSIncrementalMode -XX:+UseCMSCompactAtFullCollection -verbose:gc -Xloggc:<%= @logpath %>/<%= node.hostname %>-<%= @server %>-gclog-`date +'%Y%m%d_%H-%M-%S'`.log -XX:+PrintGCDetails -XX:+PrintTenuringDistribution -XX:+PrintGCTimeStamps -XX:ParallelGCThreads=2 -XX:+UseTLAB"
	JAVA_OPTS="$JAVA_OPTS -Dorg.jboss.resolver.warning=true -Dsun.rmi.dgc.client.gcInterval=3600000 -Dsun.rmi.dgc.server.gcInterval=3600000 -Dsun.lang.ClassLoader.allowArraySyntax=true"

	# ATG SETTINGS
	JAVA_OPTS="$JAVA_OPTS -Duser.timezone=UTC"
	JAVA_OPTS="$JAVA_OPTS -Datg.dynamo.data-dir=<%= node['atg']['home_dir'] %>/ATG-Data"
	JAVA_OPTS="$JAVA_OPTS -Datg.dynamo.liveconfig=<%= @liveconfig %>"
	JAVA_OPTS="$JAVA_OPTS -Datg.dynamo.server.name=<%= @server %>"
	JAVA_OPTS="$JAVA_OPTS -Datg.dynamo.modules=<%= @modules %>"
	
	# MONITORING
	JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.port=<%= @remote_port %>"
	JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.authenticate=false"
	JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.ssl=false"
}

PATH=$PATH:$JAVA_HOME/bin
export JAVA_HOME JBOSS_HOME JAVA_OPTS PATH
