# This file was generated by Chef

# Setup disk assisted queues
$WorkDirectory <%= node['rsyslog']['working_dir'] %>
$ActionQueueFileName fwdRule1
$ActionQueueMaxDiskSpace 1g
$ActionQueueSaveOnShutdown on
$ActionQueueType LinkedList
$ActionResumeRetryCount -1

# RsyslogGnuTLS
$DefaultNetstreamDriverCAFile <%= @crt_file %>

template(name="LogglyFormat" type="string" string="<%%pri%>%protocol-version% %timestamp:::date-rfc3339% %HOSTNAME% %app-name% %procid% %msgid% [<%= @token %>@41058 <%= @tags %>] %msg%\n")
action(type="omfwd" protocol="tcp" target="<%= node['loggly']['rsyslog']['host'] %>" port="<%= node['loggly']['rsyslog']['port'] %>" template="LogglyFormat" StreamDriver="gtls" StreamDriverMode="1" StreamDriverAuthMode="x509/name" StreamDriverPermittedPeers="*.loggly.com")