{
  "name": "cookbook-openshift3",
  "description": "Installs/Configures Openshift 3.x (>= 3.3)",
  "long_description": "Description\n===========\n\n* Installs OSEv3 and related packages.\n\nRequirements\n============\n\n## Platform ##\n\n* Tested on Red Hat RHEL 7.4\n* Tested on Centos 7.4\n\n## Openshift Version ##\n\n* Support OSE version from 3.3+\n* Support Origin version from 1.3+\n* Default the installation to 3.7\n\n**Highly recommended**: \n\nExplicitly set `node['cookbook-openshift3']['ose_version']`, `node['cookbook-openshift3']['ose_major_version']`\nand ideally `node['cookbook-openshift3']['docker_version']` to be safe when a major version is released on the\nCentOS PaaS repository; \n\nThis cookbook does support upgrade between major versions (Read doc)\n\n## New Features!\n\n- Control upgrades between versions\n- ETCD migration v2 to v3 (Mandatory before upgrading to 3.7)\n\n### Supported version\n[x] 1.3 to 1.4\n\n[x] 1.4 to 1.5\n\n[x] 1.5 to 3.6\n\n[x] 3.6 to 3.7\n\n### Control Upgrade\n\nControl upgrade requires variables to be set before running.\n\n*The CHEF run will ignore any upgrade unless all variables are correctly set*\n\nVariables:\n\n| NAME | PURPOSE | Default value | Mandatory |\n| ---------------- | ------------------------------- | ------------------ | ---------- |\n| control_upgrade | Execute an upgrade     | `false`    | `YES` |\n| control_upgrade_version | Target version (13,14,15,36,37)        |`\"\"` |`YES`|\n| control_upgrade_flag | Location of the control upgrade flag | `\"/to_be_replaced\"`  | `YES` |\n| upgrade_repos | Target YUM repo | `\"\"` | `NO` |\n\n```json\n  \"override_attributes\": {\n    \"cookbook-openshift3\": {\n      \"control_upgrade\": true,\n      \"control_upgrade_version\": \"37\",\n      \"control_upgrade_flag\": \"/tmp/ready\",\n      \"upgrade_repos\": [\n        {\n          \"name\": \"centos-openshift-origin37\",\n          \"baseurl\": \"http://mirror.centos.org/centos/7/paas/x86_64/openshift-origin37/\",\n          \"gpgcheck\": false\n        }\n      ]\n    }\n  }\n```\n\n[Read more about the upgrade process here!](docs/upgrade-process.md)\n\nTest Matrix\n===========\n\n| Platform   | OSE 3.7.0 | OSE 3.6.1 | OSE 1.5.1 | OSE 1.4.1 | OSE 1.3.3 | OSE 1.2.2 |\n| --------   | --------- | --------- | --------- | --------- | --------- | --------- |\n| centos 7.4 | PASS      | PASS      | PASS      | PASS      | PASS      | Not supported |\n\nOverride Attributes\n===================\n\n[Read more about overriding attributes here!](docs/attribute-cookbook.md)\n\n#### Structure ####\n-------------------\n\n* `node['cookbook-openshift3']['openshift_master_identity_provider']['HTPasswdPasswordIdentityProvider']`\n\n```json\n{\n\"name\" : \"htpasswd_auth\", \n\"login\" : true, \n\"challenge\" : true, \n\"kind\" : \"HTPasswdPasswordIdentityProvider\", \n\"filename\" : \"/etc/openshift/openshift-passwd\"\n}\n```\n\n* `node['cookbook-openshift3']['openshift_master_identity_provider']['LDAPPasswordIdentityProvider']`\n\n```json\n{\n\"name\" : \"ldap_identity\", \n\"login\" : true, \n\"challenge\" : true, \n\"kind\" : \"LDAPPasswordIdentityProvider\", \n\"ldap_server\" : \"ldap.domain.local\",\n \"ldap_bind_dn\" : \"\", \n \"ldap_bind_password\" : \"\",\n \"ldap_insecure\" : true, \n \"ldap_base_ou\" : \"OU=people,DC=domain,DC=local\", \n \"ldap_preferred_username\" : \"uid\"\n}\n```\n\n* `node['cookbook-openshift3']['openshift_master_asset_config']`\n\n```json\n{\n \"extensionStylesheets\":[\"/path/to/css\"],\n \"extensionScripts\":[\"/path/to/script\"],\n \"extensions\":\"/path/to/my_images\",\n \"templates\":\"/path/to/template\"\n}\n```\n\n* `node['cookbook-openshift3']['openshift_node_docker-storage']`\n\n```json\n{\n \"DEVS\": [\"/dev/sdb\",\"/dev/sdc\"],\n \"VG\": \"docker-vg\",\n \"DATA_SIZE\": \"80%FREE\"\n}\n```\n\n* `node['cookbook-openshift3']['docker_log_driver']`\n\nSet to `'json-file'` (default), `'journald'` or any other supported [docker log driver](https://docs.docker.com/engine/admin/logging/overview/).\nSet to '' to disable it.\n\n* `node['cookbook-openshift3']['docker_log_options']`\n\nAssuming `node['cookbook-openshift3']['docker_log_driver']` is `'json-file'` (the default):\n\n```json\n{\n \"max-size\": \"50M\",\n \"max-file\": \"3\"\n}\n```\n\nAny option can be set, as long as they are supported by the current [docker log driver](https://docs.docker.com/engine/admin/logging/overview/).\n\n\n* `node['cookbook-openshift3']['openshift_master_named_certificates']`\n\n* CN or SAN names are automatically detected from the certificate file.\n\n```json\n[\n  {\n   \"certfile\": \"/etc/where_is/my_certfile\",\n   \"keyfile\": \"/etc/where_is/my_keyfile\"\n  }\n]\n```\n\n* `node['cookbook-openshift3']['persistent_storage']`\n\n* They key called 'claim' is optional and will automatically create a PersistentVolumeClaim within a specified namespace.\n \n```json\n{\n  \"name\": \"registry\",\n  \"capacity\": \"5Gi\",\n  \"access_modes\": \"ReadWriteMany\",\n  \"server\": \"core.domain.local\",\n  \"path\": \"/var/nfs/registry\",\n  \"claim\": {\n    \"namespace\": \"default\"\n  }\n}\n```\n* `node['cookbook-openshift3']['openshift_hosted_cluster_metrics']`\n\nAny option can be set, as long as they are supported by the current [Metrics deployer template](https://docs.openshift.com/container-platform/latest/install_config/cluster_metrics.html#metrics-ansible-variables).\n\nFull list of attributes can be found [here](https://raw.githubusercontent.com/IshentRas/cookbook-openshift3/master/attributes/metrics.rb).\n\nWe only support 1 cassandra POD.\n\nExample of options for deploying metrics:\n```json\n{\n  \"openshift_hosted_cluster_metrics\": true,\n  \"openshift_metrics_heapster_requests_memory\": \"1Gi\",\n  \"openshift_metrics_image_version\": \"v1.5.1\",\n  \"openshift_metrics_cassandra_storage_type\": \"dynamic\",\n  \"openshift_metrics_hawkular_user_write_access\": false,\n  \".....\"\n}\n```\nExample of removing metrics components:\n```json\n{\n  \"openshift_hosted_cluster_metrics\": true,\n  \"openshift_metrics_install_metrics\": false,\n  \".....\"\n}\n```\n\nExample of overriding the default kubelet options:\n* `node['cookbook-openshift3']['openshift_node_kubelet_args_custom']`\nAny option can be set, as long as they are supported by current [Kubelet Options](https://kubernetes.io/docs/admin/kubelet/).\n\n```json\n{\n  \"openshift_node_kubelet_args_custom\": {\n    \"pods-per-core\": \"5\",\n    \"image-gc-high-threshold\": \"85\",\n    \"resolv-conf\": \"/etc/resolv.conf\"\n  },\n  \".....\"\n}\n```\n\nExample of enabling a specific \"feature-gate\": enabling the [persistent local volumes feature](https://docs.openshift.com/container-platform/3.7/install_config/configuring_local.html#local-volume-enabling-local-volumes) (OSE v3.7 and up):\n```json\n{\n  \"openshift_master_api_server_args_custom\": {\n    \"feature-gates\": [\"PersistentLocalVolumes=true\"]\n  },\n  \"openshift_master_controller_args_custom\": {\n    \"feature-gates\": [\"PersistentLocalVolumes=true\"]\n  },\n  \"openshift_node_kubelet_args_custom\": {\n    \"feature-gates\": [\"PersistentLocalVolumes=true\"]\n  }\n}\n```\n\nExample of overriding the Audit Configuration Parameters for the `openshift_master_auditconfig` Hash\n\n| Key Name   | Description |\n| --------   | --------- |\n| enable | A boolean to enable or disable audit logs. Default is `false`. |\n| audit-file | File path where the requests should be logged to. If not set, logs are printed to master logs. |\n| max-retention-day | Specifies maximum number of days to retain old audit log files based on the time stamp encoded in their filename. |\n| max-file-number | Specifies the maximum number of old audit log files to retain. |\n| max-file-size | Specifies maximum size in megabytes of the log file before it gets rotated. Defaults to 100MB. |\n\n```json\n{\n  ...\n  \"openshift_master_auditconfig\": {\n    \"enable\": true,\n    \"audit-file\": \"/var/log/audit-ocp\",\n    \"max-file-size\": \"50\",\n    \"max-file-number\": \"10\"\n  },\n  ...\n}\n```\n\nExample of overriding the Audit Configuration Parameters for the `openshift_master_auditconfig` Hash\n\n| Key Name   | Description |\n| --------   | --------- |\n| enable | A boolean to enable or disable audit logs. Default is `false`. |\n| audit-file | File path where the requests should be logged to. If not set, logs are printed to master logs. |\n| max-retention-day | Specifies maximum number of days to retain old audit log files based on the time stamp encoded in their filename. |\n| max-file-number | Specifies the maximum number of old audit log files to retain. |\n| max-file-size | Specifies maximum size in megabytes of the log file before it gets rotated. Defaults to 100MB. |\n\n```json\n{\n  ...\n  \"openshift_master_auditconfig\": {\n    \"enable\": true,\n    \"audit-file\": \"/var/log/audit-ocp\",\n    \"max-file-size\": \"50\",\n    \"max-file-number\": \"10\"\n  },\n  ...\n}\n```\n\nExample of overriding the setting for global builds:\nAny option can be set, as long as they are supported by current [Global Build Defaults and Overrides](https://docs.openshift.com/container-platform/latest/install_config/build_defaults_overrides.html).\n\n**When setting CPU/Memory via `openshift_builddefaults_resources_*`, `openshift_builddefaults_resources` needs to be set to `true`**\n\n```json\n{\n  \".....\"\n  \"openshift_builddefaults_git_http_proxy\": \"http://USER:PASSWORD@HOST:PORT\",\n  \"openshift_builddefaults_git_https_proxy\": \"https://USER:PASSWORD@HOST:PORT\",\n  \"openshift_builddefaults_git_no_proxy\": \"mycorp.com\",\n  \"openshift_builddefaults_env\": [\n    {\n      \"http_proxy\": \"http://proxy.example.com.redhat.com:3128\"\n    },\n    {\n      \"NO_PROXY\": \"ose3-master.example.com\"\n    }\n  ],\n  \"openshift_builddefaults_image_labels\": [\n    {\n      \"name\": \"imagelabelname1\",\n      \"value\": \"imagelabelvalue1\"\n    }\n  ],\n  \"openshift_builddefaults_nodeselectors\": {\n    \"nodelabel1\": \"nodelabelvalue1\",\n    \"nodelabel2\": \"nodelabelvalue2\"\n  },\n  \"openshift_builddefaults_annotations\": {\n    \"annotationkey1\": \"annotationvalue1\"\n  },\n  \"openshift_buildoverrides_force_pull\": \"true\",\n  \"openshift_buildoverrides_image_labels\": [\n    {\n      \"name\": \"imagelabelname1\",\n      \"value\": \"imagelabelvalue1\"\n    }\n  ],\n  \"openshift_buildoverrides_nodeselectors\": {\n    \"nodelabel1\": \"nodelabelvalue1\"\n  },\n  \"openshift_buildoverrides_annotations\": {\n    \"annotationkey1\": \"annotationvalue1\"\n  },\n  \".....\"\n}\n```\n\nIf OpenShift Container Platform administrators would like to control the level of overcommit and manage container density on nodes, masters can be configured to override the ratio between request and limit set on developer containers. This requires configuring the ClusterResourceOverride variables.\n\n```json\n{\n  \".....\",\n  \"openshift_clusterresourceoverrides_memorylimit_percent\": \"10\",\n  \"openshift_clusterresourceoverrides_cpulimit_percent\": \"50\",\n  \"openshift_clusterresourceoverrides_limitcputomem_percent\": \"200\",\n  \"....\"\n}\n```\n\n## Cloud Providers Integration\n\nCloud providers integration requires passing some sensetive credentials to OpenShift. This cookbook uses encrypted data bags as the safest way to achieve this. Thus you should have: \n\n- running Chef Server\n- encrypted data bags with cloud providers' credentials\n\n*Currently only AWS integration is supported.*\n\n### AWS \n\nTo integrate your OpenShift installation with AWS you should have following attributes for `cookbook-openshift3` cookbook:\n\n```json\n{\n  \"openshift_cloud_provider\": \"aws\",\n  \"openshift_cloud_providers\": {\n    \"aws\": {\n      \"data_bag_name\": \"cloud-provider\",\n      \"data_bag_item_name\": \"aws\",\n      \"secret_file\": \"/etc/chef/shared_secret\"\n    }\n  }\n}\n```\n\nYou should also have data bag named `cloud-provider` (`data_bag_name` attribute above) and encrypted with some shared secret data bag item named `aws` (`data_bag_item_name` attribute above) at your Chef Server. If `secret_file` attribute from above is *not* defined a default for Chef Client shared secret file will be used (`/etc/chef/encrypted_data_bag_secret`). For more information see [official Chef docs](https://docs.chef.io/data_bags.html#encrypt-a-data-bag-item).\n\nData bag item content should be of the form:\n\n```json\n{\n  \"id\": \"aws\",\n  \"access_key_id\": \"your_access_key_id\",\n  \"secret_access_key\": \"your_secret_access_key\"\n}\n```\n\nPlease note: `id` value should be exactly the same as `data_bag_item_name` attribute value from above.\n\n**Alternatively** you can attach IAM policies to your AWS instances and do *not* provide AWS credentials in encrypted data bags. In this case you should have the following attribute for `cookbook-openshift3` cookbook:\n\n```json\n{\n  \"openshift_cloud_provider\": \"aws\"\n}\n```\n\nand the following IAM policy attached to your *master* servers:\n\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"ec2:*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"elasticloadbalancing:*\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\nand the following IAM policy attached to your *node* servers: \n\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"ec2:Describe*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"ec2:AttachVolume\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"ec2:DetachVolume\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n=====\n\nInclude the default recipe in a CHEF role so as to ease the deployment. \n\n## Roles (Examples) \n\n* BASE\n\n```json\n{\n  \"name\": \"base\",\n  \"description\": \"Common Base Role\",\n  \"json_class\": \"Chef::Role\",\n  \"default_attributes\": {\n\n  },\n  \"override_attributes\": {\n  },\n  \"chef_type\": \"role\",\n  \"run_list\": [\n    \"recipe[cookbook-openshift3]\"\n  ],\n  \"env_run_lists\": {\n\n  }\n}\n```\n\n* UNINSTALL (ADHOC)\n\n```json\n{\n  \"name\": \"uninstall\",\n  \"description\": \"Common Base Role\",\n  \"json_class\": \"Chef::Role\",\n  \"default_attributes\": {\n\n  },\n  \"override_attributes\": {\n  },\n  \"chef_type\": \"role\",\n  \"run_list\": [\n    \"recipe[cookbook-openshift3::adhoc_uninstall]\"\n  ],\n  \"env_run_lists\": {\n\n  }\n}\n```\n\n* REDEPLOY CERTIFICATES (ADHOC)\n\nThe redeployment of the certificates requires variables and flags to be set before running.\n\n*The CHEF run will ignore any attempts unless all variables are correctly set*\n\nVariables:\n\n| NAME | PURPOSE | Default value | Mandatory | Target |\n| ---------------- | ------------------------------- | ------------------ | ---------- | ---------- |\n| adhoc_redeploy_certificates | Execute certificates redeploy    | `false`    | `YES` | Masters/Nodes/Certificate Server |\n| adhoc_redeploy_etcd_ca | Execute an ETCD CA redeploy    | `false`    | `YES` | ETCD/Masters |\n| adhoc_redeploy_cluster_ca | Execute a CLUSTER CA CERTS redeploy   | `false` | `YES` | Masters/Nodes/Certificate Server |\n| redeploy_etcd_ca_control_flag | Location of the etcd ca control flag | `\"/to_be_replaced_ca_etcd\"`  | `YES` | Certificate Server |\n| redeploy_etcd_certs_control_flag | Location of the etcd certs control flag | `\"/to_be_replaced_certs\"`  | `YES` | ETCD/Masters |\n| redeploy_cluster_ca_certserver_control_flag | Location of the cluster ca control flag | `\"/to_be_replaced_ca_cluster\"`  | `YES` | Certificate Server |\n| redeploy_cluster_ca_masters_control_flag | Location of the cluster master ca control flag | `\"/to_be_replaced_masters\"`  | `YES` | Masters |\n| redeploy_cluster_ca_nodes_control_flag | Location of the node ca control flag | `\"/to_be_replaced_nodes\"`  | `YES` | Nodes |\n| redeploy_cluster_hosted_certserver_control_flag | Location of the hosted control flag | `\"/to_be_replaced_hosted_cluster\"`  | `YES` | 1st Master |\n\n```json\n  \"override_attributes\": {\n    \"cookbook-openshift3\": {\n      \"redeploy_cluster_ca_certserver_control_flag\": \"/tmp/caready\",\n      \"adhoc_redeploy_etcd_ca\": true\n    }\n  }\n```\n\n[Read more about the certificate redeploy process here!](docs/certificates-process.md)\n\nENVIRONMENT\n===========\n\nModify the attributes as required in your environments to change how various configurations are applied per the attributes section above. \nIn general, override attributes in the environment should be used when changing attributes.\n\n### Minimal example ###\n\n* CLUSTER-NATIVE (Only available option)\n\n```json\n{\n  \"name\": \"cluster_native\",\n  \"description\": \"\",\n  \"cookbook_versions\": {\n\n  },\n  \"json_class\": \"Chef::Environment\",\n  \"chef_type\": \"environment\",\n  \"default_attributes\": {\n\n  },\n  \"override_attributes\": {\n    \"cookbook-openshift3\": {\n      \"openshift_HA\": true,\n      \"openshift_cluster_name\": \"ose-cluster.domain.local\",\n      \"persistent_storage\": [\n        {\n          \"name\": \"registry\",\n          \"capacity\": \"5Gi\",\n          \"access_modes\": \"ReadWriteMany\",\n          \"server\": \"core.domain.local\",\n          \"path\": \"/var/nfs/registry\",\n          \"claim\": {\n            \"namespace\": \"default\"\n          }\n        },\n        {\n          \"name\": \"metrics\",\n          \"capacity\": \"3Gi\",\n          \"access_modes\": \"ReadWriteOnce\",\n          \"server\": \"core.domain.local\",\n          \"path\": \"/var/nfs/metrics\",\n          \"policy\": \"Recycle\"\n        },\n        {\n          \"name\": \"logging\",\n          \"capacity\": \"2Gi\",\n          \"access_modes\": \"ReadWriteOnce\",\n          \"server\": \"core.domain.local\",\n          \"path\": \"/var/nfs/logging\",\n          \"policy\": \"Recycle\"\n        }\n      ],\n      \"lb_servers\": [\n        {\n          \"fqdn\": \"lb1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.4\"\n        },\n      ],\n      \"master_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\"\n        },\n        {\n          \"fqdn\": \"ose2-server.domain.local\",\n          \"ipaddress\": \"1.1.1.2\"\n        },\n        {\n          \"fqdn\": \"ose3-server.domain.local\",\n          \"ipaddress\": \"1.1.1.3\"\n        }\n      ],\n      \"etcd_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\"\n        },\n        {\n          \"fqdn\": \"ose2-server.domain.local\",\n          \"ipaddress\": \"1.1.1.2\"\n         \n        },\n        {\n          \"fqdn\": \"ose3-server.domain.local\",\n          \"ipaddress\": \"1.1.1.3\"\n        }\n      ],\n      \"node_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\",\n          \"schedulable\": true,\n          \"labels\": \"region=infra\"\n        },\n        {\n          \"fqdn\": \"ose2-server.domain.local\",\n          \"ipaddress\": \"1.1.1.2\",\n          \"schedulable\": true,\n          \"labels\": \"region=infra\"\n        },\n        {\n          \"fqdn\": \"ose3-server.domain.local\",\n          \"ipaddress\": \"1.1.1.3\",\n          \"schedulable\": true,\n          \"labels\": \"region=infra\"\n        },\n        {\n          \"fqdn\": \"ose4-server.domain.local\",\n          \"ipaddress\": \"1.1.1.4\",\n          \"labels\": \"region=user zone=east\"\n        },\n        {\n          \"fqdn\": \"ose5-server.domain.local\",\n          \"ipaddress\": \"1.1.1.5\",\n          \"labels\": \"region=user zone=west\"\n        },        \n      ],\n    }\n  }\n}\n```\n* SINGLE MASTER (EMBEDDED ETCD)\n\n```json\n{\n  \"name\": \"single\",\n  \"description\": \"\",\n  \"cookbook_versions\": {\n\n  },\n  \"json_class\": \"Chef::Environment\",\n  \"chef_type\": \"environment\",\n  \"default_attributes\": {\n\n  },\n  \"override_attributes\": {\n    \"cookbook-openshift3\": {\n      \"master_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\"\n        }\n      ],\n      \"node_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\"\n        },\n        {\n          \"fqdn\": \"ose2-server.domain.local\",\n          \"ipaddress\": \"1.1.1.2\",\n          \"labels\": \"region=user\"\n        }\n      ],\n    }\n  }\n}\n```\n* ADD NEW ETCD SERVERS TO CLUSTER (\"etcd_add_additional_nodes\" must be set to true and a key called \"new_node\" should be added to the server(s)\". If the server was previously part of the cluster, remember to clear its data directory before starting CHEF)\n\n**Members `must` be added one by one !!!**\n\n```json\n...\n      \"etcd_add_additional_nodes\": true,\n      \"etcd_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\"\n        },\n        {\n          \"fqdn\": \"ose2-server.domain.local\",\n          \"ipaddress\": \"1.1.1.2\"\n         \n        },\n        {\n          \"fqdn\": \"ose3-server.domain.local\",\n          \"ipaddress\": \"1.1.1.3\"\n        },\n        {\n          \"fqdn\": \"ose4-server.domain.local\",\n          \"ipaddress\": \"1.1.1.4\",\n          \"new_node\": true\n        }\n      ]\n...\n```\n* REMOVE ETCD SERVERS FROM CLUSTER (\"etcd_remove_servers\" must be defined and list all servers you want to remove. etcd_servers should be your desire state\")\n\n**You can remove all members in once!!!**\n\n```json\n...\n      \"etcd_remove_servers\": [\n        {\n          \"fqdn\": \"ose4-server.domain.local\",\n        }\n      ]\n      \"etcd_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\"\n        },\n        {\n          \"fqdn\": \"ose2-server.domain.local\",\n          \"ipaddress\": \"1.1.1.2\"\n\n        },\n        {\n          \"fqdn\": \"ose3-server.domain.local\",\n          \"ipaddress\": \"1.1.1.3\"\n        }\n      ]\n...\n```\n* EXCLUDE NODES FROM SCHEDULING AND LABELLING(\"skip_run\" must be defined and the node will be excluded when enforcing labels and schedulability\")\n  \n  Ex (ose2 and ose3 will be skipped when enforcing the schedulable and labels parts.)\n```json\n...\n      \"node_servers\": [\n        {\n          \"fqdn\": \"ose1-server.domain.local\",\n          \"ipaddress\": \"1.1.1.1\",\n          \"schedulable\": true,\n          \"labels\": \"region=infra\"\n        },\n        {\n          \"fqdn\": \"ose2-server.domain.local\",\n          \"ipaddress\": \"1.1.1.2\",\n          \"schedulable\": true,\n          \"labels\": \"region=infra\",\n\t  \"skip_run\": true\n        },\n        {\n          \"fqdn\": \"ose3-server.domain.local\",\n          \"ipaddress\": \"1.1.1.3\",\n          \"schedulable\": true,\n          \"labels\": \"region=infra\",\n\t  \"skip_run\": true\n        }\n      ]\n\n...\n```\n\n###Once it is done you should assign the node to the relevant environment.###\n```\nknife node environment set NODE_NAME ENVIRONMENT_NAME\n```\n\nRun list\n==================\n\n```\nknife node run_list add NODE_NAME 'role[base]'\n```\n\nManual Integration Test (ORIGIN)\n================================\n\nThere is a way to quickly test this cookbook. \nYou will need a CentOS 7.1+  with \"Minimal\" installation option and at least 10GB left on the Volume group. (Later used by Docker)\n\n* Deploy ORIGIN ALL IN THE BOX Flavour (MASTER + NODE)\n```\nbash <(curl -s https://raw.githubusercontent.com/IshentRas/cookbook-openshift3/master/scripts/origin_deploy.sh)\n```\n\nAutomated Integration Tests (KITCHEN)\n=====================================\n\nThis cookbook features [inspect](http://inspec.io/) integration tests,\nfor both standalone and cluster-native (HA) variants.\n\n**Attention**: the `.kitchen.yml` tests all the versions listed in the [Test Matrix](#Test Matrix),\nso use `kitchen list` and selective `kitchen converge` to only test a subset of the versions.\n\nAssuming the latest [chef-dk](https://downloads.chef.io/chefdk) is installed,\nrunning the tests is as simple as:\n\n```sh\nkitchen converge\n# wait a few minutes to give openshift a chance to initialize before running the tests\nkitchen verify\nkitchen destroy\n```\n\nCheck the `.kitchen.yml` file to get started.\n\nAutomated Integration Tests (SHUTIT)\n=====================================\n\nFor multi-node setups, testing can be done using a [ShutIt](http://ianmiell.github.io/shutit) script.\n\nThere is a [chef branch](https://github.com/ianmiell/shutit-openshift-cluster/tree/chef), which tests this cookbook.\n\n```sh\n[sudo] pip install shutit\ngit clone --recursive https://github.com/ianmiell/shutit-openshift-cluster/tree/chef\ncd shutit-openshift-cluster\n./run.sh\n```\n\nRelease Checklist\n=================\n\n- Run kitchen tests\n- Are there any attributes changes? If yes:\n- Update docs/attribute-cookbook.md and\n- Update example roles in README.md\n- Have you updated the CHANGELOG.md?\n\nDevelopment\n==================\n\nLicense and Author\n==================\n\nAuthor: William Burton (<william17.burton@gmail.com>)\n\nThe MIT License (MIT)\n\nCopyright (C) 2014 OpenBet Limited\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n",
  "maintainer": "ENC4U Ltd",
  "maintainer_email": "wburton@redhat.com",
  "license": "MIT",
  "platforms": {
    "redhat": ">= 7.1",
    "centos": ">= 7.1"
  },
  "dependencies": {
    "yum": ">= 5.0",
    "iptables": ">= 4.0.0",
    "selinux_policy": ">= 0.0.0",
    "docker": ">= 4.0"
  },
  "recommendations": {

  },
  "suggestions": {

  },
  "conflicting": {

  },
  "providing": {

  },
  "replacing": {

  },
  "attributes": {

  },
  "groupings": {

  },
  "recipes": {
    "cookbook-openshift3::adhoc_migrate_etcd": "Adhoc action for migrating ETCD from v2 to v3",
    "cookbook-openshift3::adhoc_migrate_certificate_server": "Helper for migrating old cert logic to new",
    "cookbook-openshift3::adhoc_redeploy_certificates": "Redeploy certificates",
    "cookbook-openshift3::adhoc_redeploy_cluster_ca": "Redeploy OpenShift certificates",
    "cookbook-openshift3::adhoc_redeploy_etcd_ca": "Redeploy ETCD CA certificates",
    "cookbook-openshift3::adhoc_uninstall": "Adhoc action for uninstalling Openshift from server",
    "cookbook-openshift3::certificate_server": "Configure the certificate server",
    "cookbook-openshift3::cloud_provider": "Configure cloud providers",
    "cookbook-openshift3::common": "Apply common packages",
    "cookbook-openshift3::commons": "Apply common logic",
    "cookbook-openshift3::default": "Default recipe",
    "cookbook-openshift3::docker": "Install/Configure docker service",
    "cookbook-openshift3::etcd_certificates": "Configure ETCD CA certificate",
    "cookbook-openshift3::etcd_cluster": "Configure ETCD cluster",
    "cookbook-openshift3::etcd_packages": "Install/Configure ETCD packages",
    "cookbook-openshift3::excluder": "Install/Configure the excluder packages",
    "cookbook-openshift3::master_cluster_ca": "Configure CA cluster certificate",
    "cookbook-openshift3::master_cluster_certificates": "Configure Master/Node certificates",
    "cookbook-openshift3::master_cluster": "Configure HA cluster master (Only Native method)",
    "cookbook-openshift3::master_config_post": "Configure Post actions for master server",
    "cookbook-openshift3::master_packages": "Install/Configure Master packages",
    "cookbook-openshift3::master": "Configure basic master logic",
    "cookbook-openshift3::master_standalone": "Configure standalone master logic (<= 3.6)",
    "cookbook-openshift3::node": "Configure node server",
    "cookbook-openshift3::nodes_certificates": "Configure certificates for nodes",
    "cookbook-openshift3::packages": "Configure YUM repositories",
    "cookbook-openshift3::services": "Apply common services",
    "cookbook-openshift3::upgrade_certificate_server": "Control Upgrade for the certificate server (1.3 to 3.7)",
    "cookbook-openshift3::upgrade_control_plane14": "Control Upgrade from 1.3 to 1.4 (Control plane)",
    "cookbook-openshift3::upgrade_control_plane15": "Control Upgrade from 1.4 to 1.5 (Control plane)",
    "cookbook-openshift3::upgrade_control_plane36": "Control Upgrade from 1.5 to 3.6 (Control plane)",
    "cookbook-openshift3::upgrade_control_plane37_part1": "Control Upgrade from 3.6 to 3.7 (Control plane)",
    "cookbook-openshift3::upgrade_control_plane37_part2": "Control Upgrade from 3.6 to 3.7 (Control plane)",
    "cookbook-openshift3::upgrade_control_plane37": "Control Upgrade from 3.6 to 3.7 (Control plane)",
    "cookbook-openshift3::upgrade_node14": "Control Upgrade from 1.3 to 1.4 (Node only)",
    "cookbook-openshift3::upgrade_node15": "Control Upgrade from 1.4 to 1.5 (Node only)",
    "cookbook-openshift3::upgrade_node36": "Control Upgrade from 1.5 to 3.6 (Node only)",
    "cookbook-openshift3::upgrade_node37": "Control Upgrade from 3.6 to 3.7 (Node only)",
    "cookbook-openshift3::validate": "Pre-validation check before installing OpenShift",
    "cookbook-openshift3::wire_aggregator": "Configure Wire-aggregator for Service Catalog logic (>= 3.6)"
  },
  "version": "2.0.43",
  "source_url": "https://github.com/IshentRas/cookbook-openshift3",
  "issues_url": "https://github.com/IshentRas/cookbook-openshift3/issues",
  "privacy": false,
  "chef_versions": [
    [
      ">= 12.4"
    ]
  ],
  "ohai_versions": [

  ],
  "gems": [

  ]
}
