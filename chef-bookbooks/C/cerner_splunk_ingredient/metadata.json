{
  "name": "cerner_splunk_ingredient",
  "description": "Installs and configures Splunk",
  "long_description": "# cerner\\_splunk\\_ingredient Cookbook\n\nResource cookbook which provides custom resources for installing and managing Splunk.\n\nThese resources can:\n\n- Install Splunk via downloadable package or archive\n- Start and stop the Splunk service\n\n## Requirements\n\nChef >= 12.16\nRuby >= 2.3.1\n\nSupports Linux and Windows based systems with package support for Debian, Redhat,\nand Windows.\n\nUsing resources of this cookbook to install and run Splunk means you agree to Splunk's EULA packaged with the software,\nalso available online at <http://www.splunk.com/en_us/legal/splunk-software-license-agreement.html>\n\n---\n\n## Resources\n\n### splunk\\_install\n\nManages an installation of Splunk\n\nNote: There are more specific resources available if you wish to override how Splunk is installed.\nFor example, if you want to force install from .rpm you can use splunk\\_install\\_redhat, or to install\nfrom archive (tgz for Linux and zip for Windows) use splunk\\_install\\_archive.\n\n#### Action _:install_\n\nInstalls Splunk or Universal Forwarder.\n\nProperties:\n\n| Name      |               Type(s)               | Required | Default                                          | Description                                                                                                                                                                                                                                                            |\n| :-------- | :---------------------------------: | :------: | :----------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| package   | `:splunk` or `:universal_forwarder` |  **Yes** |                                                  | Specifies the Splunk package to install. You must specify the package, or name the resource for the package; for example, `package :splunk` or `splunk_install 'universal_forwarder' do ... end`                                                                       |\n| version   |                String               |  **Yes** |                                                  | Version of Splunk to install                                                                                                                                                                                                                                           |\n| build     |                String               |  **Yes** |                                                  | Build number of the version                                                                                                                                                                                                                                            |\n| user      |                String               |    No    | `'splunk'` on Linux, current user on Windows     | User that should own the splunk installation. Currently not modifiable on Windows. Make sure you don't use a different user for running Splunk that has insufficient read/write access, or Splunk won't start!                                                         |\n| group     |                String               |    No    | Value of user property on Linux, None on Windows | Group that should own the splunk installation. Currently not modifiable on Windows.                                                                                                                                                                                    |\n| base\\_url |                String               |    No    | `'https://download.splunk.com/products'`         | Base url to pull Splunk packages from. Use this if you are mirroring the downloads for Splunk packages. The resource will append the version, os, and filename to the url like so: `{base_url}/splunk/releases/0.0.0/linux/splunk-0.0.0-a1b2c3d4e5f6-Linux-x86_64.tgz` |\n\nSpecific to splunk\\_install\\_archive\n\n| Name         | Type(s) | Required | Default                         | Description                                                                                                                                 |\n| :----------- | :-----: | :------: | :------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------ |\n| install\\_dir |  String |    No    | Depends on platform and package | Manually specify the install directory for Splunk. This can only be done when installing from an archive, otherwise it will raise an error. |\n\n#### Action _:uninstall_\n\nRemoves Splunk or Universal Forwarder and all its configuration.\n\nProperties:\n\n| Name    |               Type(s)               |                Required               | Default | Description                                                                                                                                                                                                                                      |\n| :------ | :---------------------------------: | :-----------------------------------: | :------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| package | `:splunk` or `:universal_forwarder` | **Yes, unless install\\_dir is given** |         | Specifies the Splunk package to uninstall. If you did not specify the install\\_dir, then you must specify the package, or name the resource for the package; for example, `package :splunk` or `splunk_install 'universal_forwarder' do ... end` |\n\n##### Run State\n\n`splunk_install` _stores the current installation state to the [run state](https://docs.chef.io/recipes.html#node-run-state)._\nThis contains data such as install directory and package so that subsequent resources can assume these values and avoid\nrepetition. For example, you would be able to execute `splunk_conf` after a `splunk_install` and it will inherit the\npackage of that last evaluated resource. If the install resource does nothing (installation already exists), it will\nstill load the run state from the existing installation.\n\nYou can access this state from your own recipe or resource, too. An example of the run state:\n\n```Ruby\nnode.run_state['splunk_ingredient'] = {\n  'installations' => {\n    '/opt/splunk' => {    # Install directory\n      name: 'splunk',     # Resource name\n      package: :splunk,\n      version: '5.5.5',\n      build: 'a1b2c3d4e5f6',\n      x64: true           # Architecture of the Splunk install, determined by system supported architecture.\n    }\n  },\n  'current_installation' => {\n    name: 'splunk',\n    package: :splunk,\n    ...\n    # References the last evaluated splunk_install; same as above, being the only install.\n  }\n}\n```\n\n### splunk\\_service\n\nManages an installation of Splunk. Requires splunk\\_install to be evaluated first.\n\n**The following actions (start and restart) share the same properties:**\n\n#### Action _:start_\n\nStarts the Splunk daemon if not already running.\nIf the ulimit is changed, invokes a restart of the daemon at the end of the run.\n\n#### Action _:restart_\n\nRestarts the Splunk daemon, or starts it if not already running.\n\nProperties:\n\n| Name         |               Type(s)               |                Required               | Default                               | Description                                                                                                                                                                                                                                   |\n| :----------- | :---------------------------------: | :-----------------------------------: | :------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| package      | `:splunk` or `:universal_forwarder` | **Yes, unless install\\_dir is given** |                                       | Specifies the installed Splunk package. If you did not specify the install\\_dir, then you must specify the package, or name the resource for the package; for example, `package :splunk` or `splunk_service 'universal_forwarder' do ... end` |\n| install\\_dir |                String               |                   No                  | Same as splunk\\_install               | The install directory of Splunk. If you installed to a different directory than the default, you should provide this. If install\\_dir is given, you do not need package.                                                                      |\n| ulimit       |               Integer               |                   No                  | Start up script ulimit or user ulimit | Open file ulimit to give Splunk. This sets the ulimit in the start up script (if it exists) and for the given user in `/etc/security/limits.d/`. -1 translates to `'unlimited'`                                                               |\n\n#### Action _:stop_\n\nStop the Splunk daemon if it is running.\n\nProperties:\n\n| Name         |               Type(s)               |                Required               | Default                 | Description                                                                                                                                                                                                                                   |\n| :----------- | :---------------------------------: | :-----------------------------------: | :---------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| package      | `:splunk` or `:universal_forwarder` | **Yes, unless install\\_dir is given** |                         | Specifies the installed Splunk package. If you did not specify the install\\_dir, then you must specify the package, or name the resource for the package; for example, `package :splunk` or `splunk_service 'universal_forwarder' do ... end` |\n| install\\_dir |                String               |                   No                  | Same as splunk\\_install | The install directory of Splunk. If you installed to a different directory than the default, you should provide this. If install\\_dir is given, you do not need package.                                                                      |\n\n#### Action _:init_\n\nExecutes Splunk's first time run, accepting the license agreement if applicable. This does not start Splunk, only runs its initial setup.\n\nProperties:\n\n| Name         |               Type(s)               |                Required               | Default                 | Description                                                                                                                                                                                                                                   |\n| :----------- | :---------------------------------: | :-----------------------------------: | :---------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| package      | `:splunk` or `:universal_forwarder` | **Yes, unless install\\_dir is given** |                         | Specifies the installed Splunk package. If you did not specify the install\\_dir, then you must specify the package, or name the resource for the package; for example, `package :splunk` or `splunk_service 'universal_forwarder' do ... end` |\n| install\\_dir |                String               |                   No                  | Same as splunk\\_install | The install directory of Splunk. If you installed to a different directory than the default, you should provide this. If install\\_dir is given, you do not need package.                                                                      |\n\n#### Action _:desired\\_restart_\n\nIntended to be run or notified immediately. This action creates a marker file that triggers a delayed restart later.\nThe splunk\\_service always checks for this marker file at the end of the run. This is very useful when you perform an action\nthat should cancel an unnecessary restart (such as stopping or starting the service). The marker file is removed in these\ncases and the delayed restart is effectively cancelled. It also helps when the run fails attempting to restart, because it\nwill try to restart again on the next run (assuming the marker is not cleared beforehand).\n\nYou should notify this action :immediately when you have changes that demand a restart of Splunk.\n\n### splunk\\_conf\n\nManages configuration for an installation of Splunk. Requires splunk\\_install to be evaluated first.\n\n#### Action _:configure_\n\nApplies configuration to .conf files.\nYou should know where the .conf file is that you wish to modify, as you must provide the path from `$SPLUNK_HOME/etc`.\n\nYou can specify the scope as you would in the real path to the file (`system/local/indexes.conf`) or use the `scope`\nproperty and specify this path: `system/indexes.conf`. The resource will modify local config if no scope is provided.\n\nProperties:\n\n| Name         |               Type(s)               |         Required        | Default                                          | Description                                                                                                                                                                                                                                       |\n| :----------- | :---------------------------------: | :---------------------: | :----------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |\n| path         |          String or Pathname         | **Yes (resource name)** |                                                  | Path of the .conf file from `$SPLUNK_HOME/etc`. The intermediate directory determining scope is optional. Examples: `system/indexes.conf` or `system/local/indexes.conf`.                                                                         |\n| package      | `:splunk` or `:universal_forwarder` |            No           | Package of the current install in run state      | Specifies the installed Splunk package. If you did not specify the install\\_dir, then you may specify the package (`:splunk` or `:universal_forwarder`) otherwise the resource will refer to the most recently evaluated splunk\\_install resource |\n| install\\_dir |                String               |            No           | Path of the current install in run state         | The install directory of Splunk. If you installed to a different directory than the default, you should provide this. If install\\_dir is given, you do not need package.                                                                          |\n| scope        |   `:local`, `:none`, or `:default`  |            No           | `:local`                                         | Scope of the configuration to modify. In most circumstances, you should _not_ change this. `:none` will disable checking or modifying scope in the path.                                                                                          |\n| config       |                 Hash                |         **Yes**         |                                                  | Configuration to apply to the .conf file. This hash is structured as follows: `{ section: { key: 'value' } }`. See below for more detailed explanation of the config property.                                                                    |\n| user         |            String or nil            |            No           | Owner of the current Splunk installation, if any | User that will be used to write to the .conf files.                                                                                                                                                                                               |\n| group        |            String or nil            |            No           | Group of the current Splunk installation, if any | Group that will be used to write to the .conf files.                                                                                                                                                                                              |\n| reset        |            true or false            |            No           | false                                            | When specified as true, entirely replaces existing config. By default, config is merged into the existing conf file.                                                                                                                              |\n\n#### Configuration\n\nThe configuration you provide will be evaluated against the existing config file (if it exists, and if reset is not specified).\nSymbol or string keys are irrelevant as the provided config is converted to string keys and values before being used.\n\nSome things to be aware of when using the configuration resource:\n\n##### **\"Global\" properties are evaluated under `[default]`**\n\nProperties defined at the top of the .conf file and not considered to be part of a section are assumed to be `[default]`\nper Splunk documentation: <http://docs.splunk.com/Documentation/Splunk/6.4.2/Admin/Propsconf#GLOBAL_SETTINGS>\n\n##### **Comments are not preserved**\n\nThe configuration resource can't evaluate and merge the configuration on disk and by Chef while keeping the\nrelevant comments and whitespace. The .conf file will be rewritten with the merged config and uniform whitespace.\n\n##### **Example of how the configuration is written out to disk:**\n\n```Ruby\nsplunk_conf 'system/test.conf' do\n  config(\n    testing: {\n      one: 1,\n      two: 2,\n      three: 3\n    },\n    section: {\n      key: :value\n    }\n  )\nend\n```\n\n`/opt/splunk/etc/system/local/test.conf`:\n\n```INI\n# Warning: This file is managed by Chef!\n# Comments will not be preserved and configuration may be overwritten.\n\n[testing]\none = 1\ntwo = 2\nthree = 3\n\n[section]\nkey = value\n```\n\n##### Advanced Usage\n\nThe configuration resource also can evaluate Procs in place of, or within, your config hash.\nThis approach is beneficial if you want to write your config based on the current values, or\nyou don't know all of your configuration values at compile time but can evaluate them at\nconverge time.\n\nThere are three approaches you can take to configuring with procs or lambdas: Top-level, Section-level, and Key-level.\nEach level provides a context object, providing the path of the current file and the app, section, and key when applicable.\n\n###### Top-level Evaluation\n\nTop-level evaluation is simple in concept, as you are given the entire existing config as a hash and you\nreturn the desired config.\n\nIn this example, all of the keys and values in the conf file are turned into lowercase strings.\n\n```Ruby\nsplunk_conf 'system/test.conf' do\n  config(\n    lambda do |_, conf|\n      conf.map do |section, props|\n        [section.to_s.downcase, props.map { |k, v| [k.to_s.downcase, v.to_s.downcase] }.to_h]\n      end.to_h\n    end\n  )\nend\n```\n\n###### Section-level Evaluation\n\nSection-level evaluation allows you to evaluate the config key values for a specific section without being\nresponsible for regurgitating all of the config you didn't want to modify.\n\nIn this example, only a specific section's contents are turned into lowercase strings. The rest is\nmerged as usual.\n\n```Ruby\nsplunk_conf 'system/test.conf' do\n  config(\n    testing: {\n      one: 1,\n      four: 4\n    },\n    section: ->(context, props) { props.map { |k, v| [k.to_s.downcase, v.to_s.downcase] }.to_h }\n  )\nend\n```\n\n###### Value-level Evaluation\n\nValue-level evaluation, while possible from a section-level lambda, is the more common case and thus is supported for sheer\nease of use. This is especially handy when you want to produce some value for a particular key and don't want to bother with\nnesting the rest of the section in your Proc. If there is a case where you're applying a Proc to values whose keys you don't know,\nthis becomes a necessary functionality.\n\nIn this example, if the value is an Array object, it is converted into a comma spaced string using join.\n\n```Ruby\nsplunk_conf 'system/test.conf' do\n  config(\n    testing: {\n      servers: ->(context, value) { value.is_a?(Array) ? value.join(', ') : value }\n    }\n  )\nend\n```\n\n###### The Context object\n\nA ConfContext object is passed as the first parameter to any splunk\\_conf proc. It contains contextual information such as\npath of the current file, current section (for section-level and key-level procs), and current key (for key-level procs).\nIt also attempts to determine the current app from the path, if any.\n\nThe available accessors are `#path`, `#app`, `#section`, and `#key`. Note that the context object will be frozen when provided to the proc.\n\nConsider the value-level example above:\n\n```Ruby\nsplunk_conf 'system/test.conf' do\n  config(\n    testing: {\n      servers: ->(context, value) { value.is_a?(Array) ? value.join(', ') : value }\n    }\n  )\nend\n```\n\nThe following statements would be true for the context object:\n\n```Ruby\nlambda do |context, value|\n  context.path == '/opt/splunk/etc/system/local/test.conf'\n  context.app == 'system'\n  context.section == 'testing'\n  context.key == 'servers'\n  [context.key, value]\nend\n```\n\n### splunk\\_app\\_\\*\n\nA collection of resources to install and manage Splunk Apps.\n\n#### Resources\n\n##### splunk\\_app\\_custom\n\nCreates or updates a custom Splunk app, to be configured entirely via Chef. A new custom app will create the app directory and\nnecessary sub-directories, but the files and configuration of the app must be populated via Chef resources. There is no upgrade\nstrategy for this type of app; directories will be created if they do not exist, and all further configuration is created or updated\nfrom the configs, files, and metadata properties of this resource. You can use version to control updating of this app if you\nset a version in app.conf.\n\n##### splunk\\_app\\_package\n\nInstalls or updates a Splunk app from a package/archive.\n\n#### Action _:install_\n\nInstall or upgrade a Splunk App.\n\n##### Properties for splunk\\_app\\_custom\n\n| Name         |                  Type(s)                 |           Required          | Default                                     | Description                                                                                                                                                                                                                                       |\n| :----------- | :--------------------------------------: | :-------------------------: | :------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |\n| name         |                  String                  |   **Yes (resource name)**   |                                             | Name of the app to install.                                                                                                                                                                                                                       |\n| package      |    `:splunk` or `:universal_forwarder`   |              No             | Package of the current install in run state | The installed Splunk package. If you did not specify the install\\_dir, then you may specify the package (`:splunk` or `:universal_forwarder`) otherwise the resource will refer to the most recently evaluated splunk\\_install resource           |\n| install\\_dir |                  String                  |              No             | Path of the current install in run state    | The install directory of Splunk. If you did not specfiy the package, then you may specify the install\\_dir otherwise the resource will refer to the most recently evaluated splunk\\_install resource                                              |\n| app\\_root    | String or `:shcluster` or `:master_apps` |              No             | Standard apps directory                     | The root directory to install the app. Given path can be relative (to ${SPLUNK\\_HOME}/etc) or absolute. You can give `'deployment-apps'`, `:shcluster`, or `:master_apps` to install the app to those respective cluster configuration locations. |\n| version      |                  String                  | **Yes if app is versioned** |                                             | Version of the app to install. This is required if the app has a version in its app.conf, and will only install/upgrade if the version is different or the app is not already installed. If the app has no version, this does nothing.            |\n| configs      |                   Proc                   |              No             |                                             | Proc containing `splunk_conf` resources. The resources will behave similarly to normal, except the config will be placed relative to the app directory rather than relative to the Splunk installation, and you can not change the scope.         |\n| files        |                   Proc                   |              No             |                                             | Proc containing miscellaneous resources for manipulating the app directory. This is ideally directories, templates, and files. The Proc will be given an absolute app path parameter for you to use in these resources.                           |\n| metadata     |                   Hash                   |              No             | {}                                          | Configuration to apply to the metadata (default.meta for custom apps). See splunk\\_conf for more info, and also below for special handling of the `access` key.                                                                                   |\n\n##### Properties for splunk\\_app\\_package\n\n| Name         |                  Type(s)                 |           Required          | Default                                     | Description                                                                                                                                                                                                                                       |\n| :----------- | :--------------------------------------: | :-------------------------: | :------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |\n| name         |                  String                  |   **Yes (resource name)**   |                                             | Name of the app to install.                                                                                                                                                                                                                       |\n| package      |    `:splunk` or `:universal_forwarder`   |              No             | Package of the current install in run state | The installed Splunk package. If you did not specify the install\\_dir, then you may specify the package (`:splunk` or `:universal_forwarder`) otherwise the resource will refer to the most recently evaluated splunk\\_install resource           |\n| install\\_dir |                  String                  |              No             | Path of the current install in run state    | The install directory of Splunk. If you did not specfiy the package, then you may specify the install\\_dir otherwise the resource will refer to the most recently evaluated splunk\\_install resource                                              |\n| app\\_root    | String or `:shcluster` or `:master_apps` |              No             | Standard apps directory                     | The root directory to install the app. Given path can be relative (to ${SPLUNK\\_HOME}/etc) or absolute. You can give `'deployment-apps'`, `:shcluster`, or `:master_apps` to install the app to those respective cluster configuration locations. |\n| source\\_url  |                  String                  |           **Yes**           |                                             | Source url to use for installing an app package.                                                                                                                                                                                                  |\n| version      |                  String                  | **Yes if app is versioned** |                                             | Version of the app to install. This is required if the app has a version in its app.conf, and will only install/upgrade if the version is different or the app is not already installed. If the app has no version, this does nothing.            |\n| configs      |                   Proc                   |              No             |                                             | Proc containing `splunk_conf` resources. The resources will behave similarly to normal, except the config will be placed relative to the app directory rather than relative to the Splunk installation, and you can not change the scope.         |\n| files        |                   Proc                   |              No             |                                             | Proc containing miscellaneous resources for manipulating the app directory. This is ideally directories, templates, and files. The Proc will be given an absolute app path parameter for you to use in these resources.                           |\n| metadata     |                   Hash                   |              No             | {}                                          | Configuration to apply to the metadata (local.meta for non-custom apps). See splunk\\_conf for more info, and also below for special handling of the `access` key.                                                                                 |\n\n#### Action _:uninstall_\n\nUninstalls an app, completely removing it and its files.\nNote: You can use any sub-resource or `splunk_app` to uninstall apps.\n\nProperties:\n\n| Name         |               Type(s)               |         Required        | Default                                     | Description                                                                                                                                                                                                                             |\n| :----------- | :---------------------------------: | :---------------------: | :------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| name         |                String               | **Yes (resource name)** |                                             | Name of the app to uninstall.                                                                                                                                                                                                           |\n| package      | `:splunk` or `:universal_forwarder` |            No           | Package of the current install in run state | The installed Splunk package. If you did not specify the install\\_dir, then you may specify the package (`:splunk` or `:universal_forwarder`) otherwise the resource will refer to the most recently evaluated splunk\\_install resource |\n| install\\_dir |                String               |            No           | Path of the current install in run state    | The install directory of Splunk. If you did not specfiy the package, then you may specify the install\\_dir otherwise the resource will refer to the most recently evaluated splunk\\_install resource                                    |\n\n#### Metadata\n\nThe metadata property accepts a config hash, just as `splunk_conf` would (it basically calls `splunk_conf` behind the scenes), but there is one\nimportant operation that is performed before writing the config. It looks in each section for an `access` key, and checks if the value is a hash.\nIf this is the case, then it parses this hash into a string. This is part of a special syntax to make configuring read/write permissions via Chef easier.\n\nFor example, if I want to set the following permissions for all views on the app, I might write:\n\n```INI\n[views]\naccess = read : [ * ], write : [ admin, power ]\n```\n\nWhen using splunk\\_app's metadata property, however, I can write the following hash to the same effect:\n\n```Ruby\nsplunk_app 'test_app' do\n  ...\n  metadata(views: { access: { read: '*', write: [ 'admin', 'power' ] } })\nend\n```\n\nThis helps when using programmatic values or large arrays of roles, though you _can_ still use the appropriate string instead of the Hash syntax.\n\n---\n\n## Contributing\n\nCheck out the [Github Guide to Contributing](https://guides.github.com/activities/contributing-to-open-source/)\nfor some basic tips on contributing to open source projects, and make sure to read our [Contributing Guidelines](CONTRIBUTING)\nbefore submitting an issue or pull request.\n\n## License and Authors\n\n- Author:: Alec Sears (alec.sears@cerner.com)\n\n```text\nCopyright:: 2017, Cerner Innovation, Inc.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n```\n",
  "maintainer": "Cerner Innovation, Inc.",
  "maintainer_email": "splunk@cerner.com",
  "license": "Apache-2.0",
  "platforms": {
    "redhat": ">= 6.8",
    "ubuntu": ">= 12.04",
    "windows": ">= 6.1"
  },
  "dependencies": {
    "poise-archive": "~> 1.3.0"
  },
  "recommendations": {

  },
  "suggestions": {

  },
  "conflicting": {

  },
  "providing": {

  },
  "replacing": {

  },
  "attributes": {

  },
  "groupings": {

  },
  "recipes": {

  },
  "version": "1.0.0",
  "source_url": "https://github.com/cerner/cerner_splunk_ingredient",
  "issues_url": "https://github.com/cerner/cerner_splunk_ingredient/issues",
  "privacy": false,
  "chef_versions": [
    [
      "~> 12.16"
    ]
  ],
  "ohai_versions": [

  ],
  "gems": [

  ]
}
